
## 第一部分：引言——万物皆可"塑"？

### 1.1 那个让你头疼的材料库

如果你曾经打开过任何一款有限元分析软件——无论是 ABAQUS、ANSYS、LS-DYNA 还是开源的 FEniCS、deal.II——你一定见过这样一个让人望而生畏的界面：**材料模型选择**。

在那个密密麻麻的下拉菜单里，你会看到一长串名字：

- von Mises（也叫 J2 塑性）
- Drucker-Prager
- Mohr-Coulomb
- Tresca
- Hill
- Gurson
- Cam-Clay
- Cap Model
- Johnson-Cook
- Zerilli-Armstrong
- ……

这些名字背后，是一位位力学先驱用毕生心血凝结成的理论。然而对于刚入门的工程师或研究生来说，这份"豪华菜单"带来的往往不是欣喜，而是深深的困惑：

> "我到底该选哪个？"
> 
> "这些模型到底有什么区别？"
> 
> "选错了会发生什么灾难性的后果？"

这些问题，每一个都值得用一篇论文来回答。但今天，我想聚焦于其中最基础、也是最关键的一对模型——**J2 塑性（von Mises）** 和 **Drucker-Prager 塑性**——来帮你建立对塑性本构模型的第一印象。

### 1.2 为什么是这两个？——从工程实践说起

让我先讲一个虚构的"惨案"。

几年前，某位刚入职的仿真工程师接到一个任务：模拟一根钢筋混凝土桩在土体中被压入的过程。这是一个典型的岩土-结构相互作用问题。这位工程师对钢筋的模拟驾轻就熟——当然用 von Mises 弹塑性模型，这是教科书上的标准答案。

问题出在土体上。

他想当然地给土也赋予了 von Mises 模型："反正都是塑性嘛，应该差不多。"

结果呢？

计算跑了一夜，第二天早上他看到的是一个匪夷所思的变形图：桩头周围的土体像被炸弹炸过一样向四周飞溅，体积膨胀了好几倍，而桩身几乎纹丝未动。更诡异的是，土体在侧向约束下承受巨大的围压时，居然和完全没有围压时一样容易屈服——这完全违背常识！任何一个挖过土的人都知道，地底深处的土比地表的土要"硬"得多。

问题的根源在于：**von Mises 模型根本不适合用来描述土这类摩擦性材料**。

这就是今天我们要深入探讨的核心问题：**J2 塑性和 Drucker-Prager 塑性，到底在描述什么样截然不同的物理现象？**

### 1.3 两种截然不同的材料世界

为了建立直觉，让我们暂时忘掉那些公式，先来做两个思想实验。

#### 思想实验一：捏橡皮泥

想象你手里有一块橡皮泥。你用双手从两侧挤压它，它会被压扁，变成一个饼状。在这个过程中，橡皮泥从"高"变"矮"，从"窄"变"宽"。

现在，关键的问题来了：**橡皮泥的体积变了吗？**

如果你足够细心，你会发现：**几乎没变**。橡皮泥只是改变了形状，它的总体积在塑性变形过程中基本保持不变。

这就是金属（以及橡皮泥这类近似于金属的材料）的典型特征：**塑性变形时体积守恒**。材料被拉长就会变细，被压扁就会变宽，但总的"肉"的量是不变的。

还有一个更有趣的现象：如果你把这块橡皮泥放进一个密封的容器里，然后用一个活塞从各个方向均匀地施加巨大的压力（这就是所谓的"静水压力"），会发生什么？

答案是：**几乎什么都不会发生**。橡皮泥（以及金属）的体积会稍微被压缩一点点（弹性压缩），但它绝不会因此而"屈服"或"流动"。你可以施加几个 GPa 的静水压力，只要没有剪切变形，金属就会安然无恙。

这就是 **J2 塑性（von Mises 模型）** 所描述的世界：**一个对静水压力"免疫"、塑性变形时体积不变的世界**。

#### 思想实验二：踩沙滩

现在，让我们把场景从实验室切换到海边。

你赤脚站在一片潮湿的细沙上。当你的脚掌压下去的时候，你会注意到一个奇怪的现象：**脚印周围的沙子会微微隆起，而且颜色会变浅（变干）**。

这是怎么回事？

答案是：**沙子的体积发生了变化**。当你的脚施加压力时，沙粒之间需要发生错动（剪切变形）。但是，紧密堆积的沙粒想要滑过彼此，就必须先"爬"到对方的"肩膀"上——就像一堆叠在一起的乒乓球，==你要让它们错开，它们就必须先向上弹起==。这个过程导致了沙子整体的**体积膨胀**。体积膨胀把原本填充在孔隙里的水挤走了，所以沙子看起来变干了。

这个现象有一个专门的名字，叫做**剪胀性（Dilatancy）**。这是岩土类颗粒材料独有的特征。

还有一个更关键的区别：**压力越大，沙子越难被剪切**。

想象一下，在地表挖一铲沙子很容易。但如果你在地下 100 米深处挖沙子呢？那里的沙子承受着来自上方所有土层的巨大重量（围压），它会变得异常坚硬，几乎像岩石一样难以挖掘。这不是因为沙子本身变了，而是因为**摩擦力**。颗粒之间的摩擦力随着正压力（围压）的增大而增大，所以克服摩擦让颗粒错动所需的力也更大。

这就是 **Drucker-Prager 塑性** 所描述的世界：**一个对静水压力高度敏感、塑性变形时体积会发生变化的世界**。

### 1.4 核心冲突：一张图看清本质

让我用一个表格来总结这两种材料世界的核心差异：

| 特征             | J2 塑性 (von Mises) - "橡皮泥世界" | Drucker-Prager 塑性 - "沙滩世界" |
| ---------------- | ---------------------------------- | -------------------------------- |
| **典型材料**     | 金属（钢、铝、铜）、部分聚合物     | 岩石、土壤、混凝土、陶瓷         |
| **压力敏感性**   | **不敏感**：静水压力不影响屈服     | **敏感**：压力越大越难屈服       |
| **塑性体积变形** | **恒为零**：变形只改变形状         | **非零**：可能膨胀（剪胀）或压缩 |
| **物理机制**     | 位错滑移（晶体层面的错动）         | 颗粒摩擦与重排                   |
| **屈服面几何**   | 圆柱体                             | 圆锥体                           |

**【图示建议】**

> **图1-1：两种材料世界的直观对比**
> 
> 图片分为左右两部分。
> 
> **左图（J2/von Mises 世界）**：
> - 上半部分：一块橡皮泥/金属块被两只手从侧面挤压，变形但体积不变。
> - 下半部分：同一块材料放在一个压力容器里，四周有箭头表示均匀的静水压力，材料没有任何变形，旁边有文字注释："再大的均匀压力也无法使其屈服"。
> 
> **右图（Drucker-Prager 世界）**：
> - 上半部分：一只脚踩在沙滩上，脚印周围的沙子隆起，有箭头指示体积膨胀。
> - 下半部分：一个示意图表示地下不同深度的土层，越深的地方颜色越深，旁边有文字注释："越深的土承受围压越大，强度越高"。
> 
> 图的标题：**"捏橡皮泥"与"踩沙滩"——两种塑性行为的直观对比**

### 1.5 本文的目标：从直觉到代码的全链路

现在，你已经对这两种模型有了一个感性的认识。但这远远不够。

如果你是一个做仿真的工程师，你需要知道：

1.  **为什么它们在数学上长这个样子？** —— 那些公式里的 $J_2$、$I_1$、$\sigma_y$、$\alpha$、$k$ 到底是什么意思？
2.  **它们在应力空间里长什么样？** —— 为什么一个是圆柱，一个是圆锥？这个几何形状和材料行为有什么关系？
3.  **数值实现时有哪些坑？** —— 为什么 DP 比 J2 难算那么多？那个"圆锥顶点"到底是怎么回事？

如果你是一个想写 可微分FEM 的研究生，你更需要知道：

4.  **回波映射（Return Mapping）算法的细节是什么？** —— J2 的"径向回归"和 DP 的"耦合回归"有什么不同？
5.  **一致切线刚度（Consistent Tangent）怎么推导？** —— 这个东西到底是什么，为什么说它是牛顿迭代收敛的命门？
6.  **非关联流动（Non-associative Flow）会带来什么麻烦？** —— 为什么刚度矩阵可能变成非对称的？

这篇博客的目标，就是**从几何直观出发，穿越数学公式的丛林，最终抵达数值算法的彼岸**，帮你构建一个关于塑性本构模型的完整认知框架。

读完这篇文章，你将能够：

-   向别人解释 J2 和 DP 的核心区别。
-   知道为什么在做有限元仿真时，需要选择不同的本构模型。
-   理解基于回波映射的本构积分算法。
-   对更高级的本构模型（如 Cam-Clay、Cap Model、各向异性塑性等）有一个入门的基础。

好了，热身结束。让我们正式进入塑性力学的奇妙世界。

在下一部分，我们将首先建立一套描述应力状态的"地图系统"——**主应力空间与偏平面**。有了这套工具，J2 的"圆柱"和 DP 的"圆锥"才能在你的脑海中栩栩如生地浮现出来。

---

<!-- TAB_BREAK: 几何直观 -->

## 第二部分：几何直观——圆柱与圆锥的战争

### 2.1 为什么需要"应力空间"这张地图？

在深入讨论 J2 和 Drucker-Prager 之前，我们必须先建立一套描述应力状态的"坐标系统"。这就像你想描述一座城市的地形，你需要先有一张地图。

在力学中，我们用**应力张量（Stress Tensor）** 来描述材料内部某一点的受力状态。对于三维问题，这个张量有 6 个独立分量（3 个正应力 + 3 个剪应力）。但 6 维空间太抽象了，人类的大脑无法直接可视化。

幸运的是，力学家们发现了一个巧妙的简化方法：利用**主应力（Principal Stresses）**。

任何一个应力状态，无论它看起来多么复杂，都可以找到一组特殊的坐标轴（称为主方向），在这组坐标轴下，所有的剪应力分量都消失了，只剩下三个正应力分量 $\sigma_1$、$\sigma_2$、$\sigma_3$。这三个数就是**主应力**。

> **物理直觉**：想象一个微小的立方体材料单元。你总能把它旋转到一个特殊的角度，使得它的六个面上只承受垂直于面的正压力或拉力，而没有任何让它"扭动"的剪力。这六个面上的应力，就是主应力。

有了主应力，我们就可以把任何一个应力状态表示为三维空间 $(\sigma_1, \sigma_2, \sigma_3)$ 中的一个点。这个三维空间，就是我们的"地图"——**主应力空间（Principal Stress Space）**，也常被称为**Haigh-Westergaard 应力空间**。

### 2.2 主应力空间的两个核心坐标轴

在这张"地图"上，有两个特殊的方向，它们具有极其重要的物理意义。

#### 2.2.1 静水压力轴（Hydrostatic Axis）

想象主应力空间中那条特殊的直线：$\sigma_1 = \sigma_2 = \sigma_3$。

在这条线上的任何一点，三个主应力都相等。这意味着什么？

这意味着材料单元在各个方向上承受着**完全相同的正压力（或拉力）**。这种应力状态没有任何"扭曲"的成分，只会让材料均匀地"胀大"或"缩小"——就像一个气球被均匀地充气或放气。

这种应力状态叫做**静水压力状态（Hydrostatic Stress State）**，因为它和一个物体浸没在静止流体中所承受的压力是一样的——各个方向都相等。

这条 $\sigma_1 = \sigma_2 = \sigma_3$ 的直线，就是**静水压力轴**。它在主应力空间中是一条从原点出发、方向为 $(1, 1, 1)$（或其归一化形式 $(\frac{1}{\sqrt{3}}, \frac{1}{\sqrt{3}}, \frac{1}{\sqrt{3}})$）的射线。

我们用一个标量来度量沿着这条轴"走"了多远：

$$
p = -\frac{1}{3}(\sigma_1 + \sigma_2 + \sigma_3) = -\frac{1}{3}I_1
$$

或者用平均应力（注意正负号约定）：

$$
\sigma_m = \frac{1}{3}(\sigma_1 + \sigma_2 + \sigma_3) = \frac{I_1}{3}
$$

这里，$I_1 = \sigma_1 + \sigma_2 + \sigma_3$ 是应力张量的**第一不变量（First Invariant）**。

> **不变量**的意思是：无论你怎么旋转坐标系，这个值都不变。它只和应力状态本身有关，和你观察它的角度无关。

**物理意义**：$I_1$（或 $\sigma_m$）描述了应力状态中"均匀压缩/拉伸"的成分，即引起**体积变化**的成分。

#### 2.2.2 偏平面（Deviatoric Plane / π-Plane）

现在，让我们从静水压力轴上任意取一点（比如点 $A$，代表某个静水压力水平），然后作一个**垂直于静水压力轴的平面**。

这个平面，就叫做**偏平面（Deviatoric Plane）**，也常被称为 **$\pi$ 平面**。

偏平面上的任何一点，都代表一种"纯剪切"或"纯形状改变"的应力状态。在这个平面上，我们把原始应力张量减去其静水压力部分，得到的东西叫做**偏应力张量（Deviatoric Stress Tensor）**：

$$
s_{ij} = \sigma_{ij} - \sigma_m \delta_{ij}
$$

其中 $\delta_{ij}$ 是 Kronecker delta（单位矩阵）。

偏应力张量的三个主值是：

$$
s_1 = \sigma_1 - \sigma_m, \quad s_2 = \sigma_2 - \sigma_m, \quad s_3 = \sigma_3 - \sigma_m
$$

注意一个重要的性质：$s_1 + s_2 + s_3 = 0$。这意味着偏应力没有任何"体积变化"的成分，它纯粹描述形状的改变。

我们用另一个不变量来度量偏平面上"走"了多远（即偏离静水压力轴的距离）：

$$
J_2 = \frac{1}{2}(s_1^2 + s_2^2 + s_3^2) = \frac{1}{2}s_{ij}s_{ij} （爱因斯坦求和）
$$

这就是**第二偏应力不变量（Second Deviatoric Invariant）**，也是 J2 塑性名字的由来。

一个更常用的量是**等效应力（Equivalent Stress）**或 **von Mises 应力**：

$$
\bar{\sigma} = \sqrt{3J_2} = \sqrt{\frac{3}{2}s_{ij}s_{ij}}
$$

在主应力空间中，从静水压力轴到某点的垂直距离（投影到偏平面上的距离），正比于 $\sqrt{J_2}$。

**物理意义**：$J_2$（或 $\bar{\sigma}$）描述了应力状态中"扭曲/剪切"的成分，即引起**形状改变**的成分。

#### 2.2.3 小结：分解应力的两个维度

至此，我们已经建立了一套强大的工具来分解任何应力状态：

| 坐标/指标                  | 物理意义              | 数学表达                                   |
| -------------------------- | --------------------- | ------------------------------------------ |
| $I_1$（或 $\sigma_m$）     | 体积变化（压缩/膨胀） | $I_1 = \sigma_1 + \sigma_2 + \sigma_3$     |
| $J_2$（或 $\bar{\sigma}$） | 形状改变（剪切/扭曲） | $J_2 = \frac{1}{2}(s_1^2 + s_2^2 + s_3^2)$ |

任何一个应力状态，都可以唯一地分解为"沿静水压力轴走多远"（$I_1$）和"在偏平面上离轴心多远"（$\sqrt{J_2}$）这两个信息的组合。

**【图示建议】**

> **图2-1：主应力空间与坐标分解**
> 
> 图片展示一个三维坐标系 $(\sigma_1, \sigma_2, \sigma_3)$。
> 
> - 画出从原点出发、方向为 $(1,1,1)$ 的**静水压力轴**（用红色粗线标注），轴上标注几个点如"纯静水压力"。
> - 在静水压力轴上某点处，画出一个**垂直于该轴的灰色半透明平面**，标注为"$\pi$ 平面（偏平面）"。
> - 在空间中任取一点 $P$，代表某个一般应力状态。
> - 从 $P$ 向静水压力轴作垂线，垂足为 $H$。
> - 用**蓝色箭头**标注从原点 $O$ 到 $H$ 的距离，注释为"$\propto I_1$（静水压力分量）"。
> - 用**绿色箭头**标注从 $H$ 到 $P$ 的距离，注释为"$\propto \sqrt{J_2}$（偏应力分量）"。
> 
> 图的标题：**主应力空间中的坐标分解：$I_1$ 与 $J_2$**

### 2.3 J2 塑性（von Mises）：一个无限长的圆柱体

现在，让我们用刚刚建立的"地图系统"来看看 J2 塑性的屈服面长什么样。

#### 2.3.1 屈服准则的数学形式

von Mises 屈服准则（也叫 J2 屈服准则）说的是：

> **材料屈服，当且仅当等效应力 $\bar{\sigma}$ 达到某个临界值 $\sigma_Y$（屈服强度）。**

用数学语言写出来，就是**屈服函数（Yield Function）**：

$$
f(\boldsymbol{\sigma}) = \bar{\sigma} - \sigma_Y = \sqrt{3J_2} - \sigma_Y = 0
$$

或者更常见的等价形式（为了后续推导方便，避免开根号）：

$$
f(\boldsymbol{\sigma}) = J_2 - \frac{\sigma_Y^2}{3} = 0
$$

让我们仔细看看这个公式：

-   它**只**包含 $J_2$。
-   它**完全不包含** $I_1$。

这意味着什么？

这意味着：**静水压力 $I_1$ 对屈服没有任何影响**。无论你给材料施加多大的均匀压力（让 $I_1$ 变得很大或很小），只要 $J_2$（偏应力部分）没有达到临界值，材料就不会屈服。

#### 2.3.2 几何形状：圆柱体

现在让我们把这个屈服准则画在主应力空间里。

$f = \sqrt{3J_2} - \sigma_Y = 0$ 可以改写为 $\sqrt{J_2} = \frac{\sigma_Y}{\sqrt{3}}$。

在主应力空间中，$\sqrt{J_2}$ 代表的是**一点到静水压力轴的垂直距离**。

所以，满足 $\sqrt{J_2} = \text{常数}$ 的所有点，构成的曲面是什么？

是一个**以静水压力轴为中心轴、半径为常数的圆柱面**！

这个圆柱面：

-   **轴心**：静水压力轴（$\sigma_1 = \sigma_2 = \sigma_3$）。
-   **半径**：$r = \sqrt{\frac{2}{3}}\sigma_Y$（在偏平面上的投影是一个圆）。
-   **长度**：**无限长**！它沿着静水压力轴两个方向无限延伸。

**【图示建议】**

> **图2-2：J2 (von Mises) 屈服面的几何形状——圆柱体**
> 
> 图片展示三维主应力空间 $(\sigma_1, \sigma_2, \sigma_3)$。
> 
> - 画出静水压力轴（虚线）。
> - 画出一个**无限长的圆柱面**（半透明淡蓝色或淡绿色），圆柱的轴心与静水压力轴重合。
> - 在圆柱面上用实线画出几个垂直于轴的横截面（圆形），表明任何偏平面与圆柱面的交线都是圆。
> - 圆柱面内部标注"弹性区（Elastic）"，表面标注"屈服面（Yield Surface）"。
> - 在图的角落插入一个小图：$\pi$ 平面（偏平面）上的视图，展示屈服面投影为一个**正圆**。
> 
> 图的标题：**von Mises (J2) 屈服面：一个无限长的圆柱体**

#### 2.3.3 物理意义再解读

这个圆柱体的几何形状，完美地诠释了金属（以及类似材料）的塑性行为：

1.  **静水压力不影响屈服**：圆柱沿静水压力轴无限延伸。你可以沿着这根轴随便走（改变 $I_1$），只要你不"走出"圆柱的半径范围（$\sqrt{J_2}$ 保持在临界值以下），你就永远待在弹性区内，永远不会碰到屈服面。

2.  **剪切控制屈服**：只有当你沿着"径向"（偏平面上，远离轴心的方向）走得足够远，即 $\sqrt{J_2}$ 足够大时，你才会碰到圆柱的表面——屈服。

3.  **深海潜水员的安全**：这就是为什么深海潜水艇的金属外壳可以承受巨大的静水压力而不"屈服"。只要设计得当，避免应力集中导致的局部剪切过大，金属结构在均匀高压下是非常安全的。

#### 2.3.4 为什么是圆？——各向同性

你可能注意到了，J2 屈服面在偏平面上的投影是一个**正圆**，而不是椭圆或其他形状。

这反映了一个重要的假设：**各向同性（Isotropy）**。

von Mises 模型假设材料的性质在各个方向上都是相同的。无论你从哪个方向施加剪切，材料的屈服强度都一样。这对于大多数金属（尤其是经过适当热处理、组织均匀的金属）来说是一个很好的近似。

> **对比**：如果材料是各向异性的（如纤维增强复合材料、轧制后的金属板），屈服面在偏平面上的投影就不再是正圆，而是椭圆或其他复杂形状。这就是 **Hill 各向异性屈服准则**等更复杂模型要处理的问题。

### 2.4 Drucker-Prager 塑性：一个张开的圆锥体

接下来，让我们看看 Drucker-Prager 屈服面是什么样子。

#### 2.4.1 屈服准则的数学形式

Drucker-Prager 屈服准则引入了对静水压力的敏感性：

$$
f(\boldsymbol{\sigma}) = \sqrt{J_2} + \alpha I_1 - k = 0
$$

其中：
-   $\sqrt{J_2}$：偏应力的大小（和 von Mises 一样）。
-   $I_1 = \sigma_1 + \sigma_2 + \sigma_3$：第一应力不变量（静水压力的 3 倍，带正负号）。
-   $\alpha$ 和 $k$：两个材料参数。

关键的变化在于：**多了一个 $\alpha I_1$ 项**！

让我们分析这个公式的含义：

-   当 $I_1 < 0$（即材料处于压缩状态，$\sigma_1 + \sigma_2 + \sigma_3 < 0$，考虑压缩为负的约定）时，$\alpha I_1$ 是负的，所以屈服条件变为 $\sqrt{J_2} = k - \alpha|I_1|$。这意味着 **$\sqrt{J_2}$ 可以更小，材料更容易屈服**……等等，这好像不对？

让我重新考虑一下正负号约定。在岩土力学中，**压应力通常取正**。我们采用这个约定：

$$
\sigma_m = \frac{1}{3}(\sigma_1 + \sigma_2 + \sigma_3) > 0 \text{ 表示压缩}
$$

于是 Drucker-Prager 屈服准则更常见的形式是：

$$
f(\boldsymbol{\sigma}) = \sqrt{J_2} - \alpha I_1 - k = 0
$$

或者写成：

$$
\sqrt{J_2} = k + \alpha I_1
$$

现在让我们重新分析：

-   当 $I_1 > 0$（压缩状态）时，$k + \alpha I_1 > k$，材料需要更大的 $\sqrt{J_2}$ 才能屈服——**压缩使材料变强**。
-   当 $I_1 = 0$（纯剪切，无静水应力）时，$\sqrt{J_2} = k$，材料在偏应力达到 $k$ 时屈服。
-   当 $I_1 < 0$（拉伸状态）时，$\sqrt{J_2} = k + \alpha I_1 < k$，材料需要更小的 $\sqrt{J_2}$ 就会屈服——**拉伸使材料变弱**。

这完美地描述了岩土材料的**摩擦特性**：围压越大，强度越高。

> **注意**：不同教材和软件对正负号的约定不同，使用时务必核实。本文后续统一采用**拉为正、压为负**的固体力学惯例，所以 DP 准则写为 $f = \sqrt{J_2} + \alpha I_1 - k = 0$，其中压缩时 $I_1 < 0$。

#### 2.4.2 几何形状：圆锥体

现在让我们把 Drucker-Prager 屈服面画出来。

从公式 $\sqrt{J_2} + \alpha I_1 - k = 0$（采用拉正压负约定）可以得到：

$$
\sqrt{J_2} = k - \alpha I_1
$$

在主应力空间中：
-   $I_1$ 正比于沿静水压力轴的坐标。
-   $\sqrt{J_2}$ 正比于到静水压力轴的垂直距离。

所以这个方程描述的是：**到轴心的距离随着沿轴位置线性变化**。

这是什么形状？**圆锥面**！

具体来说：

-   **轴心**：静水压力轴。
-   **顶点（Apex）**：当 $\sqrt{J_2} = 0$ 时（即在轴上），$I_1 = k/\alpha$。这意味着圆锥有一个顶点，位于静水压力轴上的某一点。
-   **张角**：由 $\alpha$ 决定。$\alpha$ 越大，圆锥越"尖"（张角越小）。
-   **开口方向**：朝向压缩区（$I_1 < 0$ 或围压增大的方向）。

**【图示建议】**

> **图2-3：Drucker-Prager 屈服面的几何形状——圆锥体**
> 
> 图片展示三维主应力空间 $(\sigma_1, \sigma_2, \sigma_3)$。
> 
> - 画出静水压力轴（虚线）。
> - 画出一个**圆锥面**（半透明橙色或红色），圆锥的轴心与静水压力轴重合。
> - 圆锥的顶点在**拉伸侧**（$I_1 > 0$ 的方向），开口朝向**压缩侧**（$I_1 < 0$ 的方向）。
> - 顶点位置用一个点标注，注释为"Apex（顶点）"。
> - 在圆锥面上用实线画出几个垂直于轴的横截面（圆形），注意这些圆的半径随着远离顶点而增大。
> - 圆锥面内部标注"弹性区（Elastic）"，表面标注"屈服面（Yield Surface）"。
> - 在图的角落插入一个小图：$\pi$ 平面上的视图，展示屈服面投影仍为一个**正圆**，但注明"半径随 $I_1$ 变化"。
> 
> 图的标题：**Drucker-Prager 屈服面：一个顶点朝向拉伸区的圆锥体**

#### 2.4.3 物理意义再解读

圆锥体的几何形状深刻地揭示了岩土（及混凝土、岩石等）材料的力学特性：

1.  **压力敏感性（摩擦效应）**：圆锥沿着压缩方向张开。这意味着在高围压下（深入圆锥内部），弹性区的"半径"（$\sqrt{J_2}$ 的临界值）更大，材料更难屈服。这就是"越深越硬"的物理根源。

2.  **拉伸脆弱性**：圆锥在拉伸侧收缩并最终汇聚于顶点。这意味着材料在拉伸状态下的强度很低。事实上，当 $I_1$ 达到顶点位置 $I_1 = k/\alpha$ 时，材料即使没有任何剪切（$\sqrt{J_2} = 0$）也会"屈服"——更准确地说，是**拉伸破坏**。这解释了为什么混凝土和土的抗拉强度远低于抗压强度。

3.  **与 Mohr-Coulomb 的联系**：Drucker-Prager 模型实际上是著名的**Mohr-Coulomb 屈服准则**的一种"光滑化"近似。Mohr-Coulomb 在偏平面上的投影是一个不规则的六边形（因为它区分拉伸和压缩子午线），而 Drucker-Prager 把它简化成了正圆，从而使数学处理更加方便。

#### 2.4.4 参数 $\alpha$ 和 $k$ 从何而来？

Drucker-Prager 参数 $\alpha$ 和 $k$ 通常是从实验数据（如三轴压缩试验）或从 Mohr-Coulomb 参数（黏聚力 $c$ 和内摩擦角 $\phi$）转换而来。

最常用的转换公式（取决于假设的匹配条件）是：

**对于匹配三轴压缩实验（外切 Mohr-Coulomb 圆锥）**：
$$
\alpha = \frac{2\sin\phi}{\sqrt{3}(3 - \sin\phi)}, \quad k = \frac{6c\cos\phi}{\sqrt{3}(3 - \sin\phi)}
$$

**对于匹配三轴拉伸实验（内切 Mohr-Coulomb 圆锥）**：
$$
\alpha = \frac{2\sin\phi}{\sqrt{3}(3 + \sin\phi)}, \quad k = \frac{6c\cos\phi}{\sqrt{3}(3 + \sin\phi)}
$$

**对于平面应变条件**：
$$
\alpha = \frac{\tan\phi}{\sqrt{9 + 12\tan^2\phi}}, \quad k = \frac{3c}{\sqrt{9 + 12\tan^2\phi}}
$$

> **实用建议**：在使用有限元软件时，务必查阅软件文档，确认它采用的是哪种匹配方式。不同的匹配方式会导致相同的 $c$ 和 $\phi$ 对应不同的 $\alpha$ 和 $k$ 值，从而影响计算结果。

### 2.5 圆柱与圆锥：一张图看清差异

**【图示建议】**

> **图2-4：J2 (von Mises) 与 Drucker-Prager 屈服面的对比**
> 
> 图片分为左右两部分，或在同一个三维坐标系中叠加展示。
> 
> **左图/蓝色层**：von Mises 圆柱面，半透明，沿静水压力轴无限延伸。
> 
> **右图/橙色层**：Drucker-Prager 圆锥面，半透明，顶点在拉伸侧，开口朝向压缩侧。
> 
> **关键标注**：
> - 圆柱面上注释："$I_1$ 变化对屈服无影响"。
> - 圆锥面上注释："$I_1$ 增大（压缩）→ 屈服面扩大"。
> - 静水压力轴上标注"拉伸"和"压缩"方向。
> - 可选：在某个特定的 $\pi$ 平面上，画出两者的截面——圆柱截面是一个固定大小的圆，圆锥截面也是圆，但半径取决于该平面在轴上的位置。
> 
> 图的标题：**圆柱 vs 圆锥：J2 与 Drucker-Prager 屈服面的几何对比**

### 2.6 一个容易被忽视的细节：子午线与偏平面截面

为了更全面地理解屈服面的几何，我们还需要引入两种"切片"视角：

#### 2.6.1 子午线（Meridional Section）

用一个包含静水压力轴的平面去切割屈服面，得到的截线叫做**子午线**。

-   **J2 (von Mises)**：子午线是**两条平行于静水压力轴的直线**（圆柱的侧面轮廓），与轴等距。
-   **Drucker-Prager**：子午线是**两条从顶点出发、向压缩侧张开的直线**（圆锥的侧面轮廓）。

子午线的形状直观地展示了屈服应力如何随静水压力变化。

#### 2.6.2 偏平面截面（Deviatoric Section）

用一个垂直于静水压力轴的偏平面去切割屈服面，得到的截线叫做**偏平面截面**。

-   **J2 (von Mises)**：偏平面截面是**正圆**，半径固定，与在哪个偏平面切割无关。
-   **Drucker-Prager**：偏平面截面也是**正圆**，但半径取决于该偏平面在静水压力轴上的位置——离顶点越远（围压越大），半径越大。

这里有一个有趣的对比：**Mohr-Coulomb 准则**在偏平面上的截面是一个**不规则六边形**（有六个角，对应于六种不同的主应力排列顺序），而 Drucker-Prager 为了数学简便，把它"磨圆"成了正圆。

**【图示建议】**

> **图2-5：子午线与偏平面截面对比**
> 
> 图片分为上下两行，左右两列：
> 
> |  | J2 (von Mises) | Drucker-Prager |
> |---|---|---|
> | **子午线** | 两条平行直线，与静水压力轴等距 | 两条从顶点发散的直线 |
> | **偏平面截面** | 固定半径的正圆 | 变半径的正圆（可选：与 Mohr-Coulomb 六边形对比） |
> 
> 每个格子里放一张简单的 2D 示意图。
> 
> 图的标题：**子午线与偏平面截面：两种屈服面的"剖面"对比**

### 2.7 本节小结

在这一部分，我们建立了描述应力状态的几何框架——**主应力空间**，并引入了两个核心的不变量：

-   $I_1$（静水压力分量）：度量沿静水压力轴的位置，与体积变化相关。
-   $J_2$（偏应力分量）：度量到静水压力轴的距离，与形状改变（剪切）相关。

在此基础上，我们看到了 J2 和 Drucker-Prager 屈服面截然不同的几何形状：

| 模型           | 几何形状                   | 对 $I_1$ 的依赖 | 物理图景                           |
| -------------- | -------------------------- | --------------- | ---------------------------------- |
| J2 (von Mises) | 无限长的**圆柱体**         | **无**          | "不管压力多大，只有剪切能让我屈服" |
| Drucker-Prager | **圆锥体**（顶点在拉伸侧） | **线性**        | "压力越大，我越强；拉伸是我的软肋" |

几何直观是理解本构模型的第一步。但光有"形状"还不够，我们还需要深入数学内核，搞清楚这些公式是怎么来的，参数又该如何解读。这就是下一部分要讨论的内容。

---

<!-- TAB_BREAK: 数学内核 -->

## 第三部分：数学内核——不变量与方程

### 3.1 从几何到代数：屈服函数的严格定义

在上一部分，我们用几何图形建立了对 J2 和 Drucker-Prager 屈服面的直观认识。但在实际的数值计算中，我们需要的是精确的数学表达式。这一部分，我们将深入探讨屈服函数的数学形式，理解每一个符号背后的物理意义。

#### 3.1.1 什么是屈服函数？

**屈服函数（Yield Function）** $f(\boldsymbol{\sigma})$ 是塑性力学中最核心的概念之一。它是一个关于应力张量的标量函数，用来判断材料当前是处于弹性状态还是塑性状态。

屈服函数的判据规则非常简单：

$$
\begin{cases}
f(\boldsymbol{\sigma}) < 0 & \text{弹性状态（应力点在屈服面内部）} \\
f(\boldsymbol{\sigma}) = 0 & \text{屈服状态（应力点在屈服面上）} \\
f(\boldsymbol{\sigma}) > 0 & \text{不允许（违反塑性一致性条件）}
\end{cases}
$$

这里有一个关键的约束：在经典的**率无关塑性（Rate-Independent Plasticity）** 理论中，应力状态**永远不能穿透屈服面**，即 $f(\boldsymbol{\sigma}) > 0$ 是被禁止的。如果加载过程试图让应力点"冲出"屈服面，塑性变形就会发生，把应力点"拉回"到屈服面上。这就是所谓的**塑性一致性条件（Plastic Consistency Condition）**。

#### 3.1.2 应力不变量：屈服函数的基本构建块

要构造屈服函数，我们首先需要一套描述应力状态的"原材料"。最常用的原材料是**应力不变量（Stress Invariants）**。

为什么要用不变量？因为**材料的屈服行为不应该依赖于我们选择的坐标系**。如果你把一块钢旋转 45 度，它的屈服强度不会改变。应力不变量恰好满足这个要求——无论坐标系怎么旋转，它们的值都保持不变。

##### 应力张量的三个基本不变量

对于应力张量 $\boldsymbol{\sigma}$，其三个**主不变量（Principal Invariants）** 定义为：

$$
I_1 = \text{tr}(\boldsymbol{\sigma}) = \sigma_{ii} = \sigma_1 + \sigma_2 + \sigma_3
$$

$$
I_2 = \frac{1}{2}\left[(\text{tr}\boldsymbol{\sigma})^2 - \text{tr}(\boldsymbol{\sigma}^2)\right] = \sigma_1\sigma_2 + \sigma_2\sigma_3 + \sigma_3\sigma_1
$$

$$
I_3 = \det(\boldsymbol{\sigma}) = \sigma_1\sigma_2\sigma_3
$$

其中 $\sigma_1, \sigma_2, \sigma_3$ 是三个主应力。

##### 偏应力张量及其不变量

**偏应力张量（Deviatoric Stress Tensor）** 定义为：

$$
\mathbf{s} = \boldsymbol{\sigma} - \frac{1}{3}I_1\mathbf{I} = \boldsymbol{\sigma} - \sigma_m\mathbf{I}
$$

其中 $\sigma_m = \frac{1}{3}I_1$ 是平均应力（静水压力），$\mathbf{I}$ 是单位张量。

偏应力张量也有三个不变量 $J_1, J_2, J_3$：

$$
J_1 = \text{tr}(\mathbf{s}) = s_{ii} = 0 \quad \text{（恒等于零！）}
$$

$$
J_2 = \frac{1}{2}\text{tr}(\mathbf{s}^2) = \frac{1}{2}s_{ij}s_{ij} = \frac{1}{2}(s_1^2 + s_2^2 + s_3^2)
$$

$$
J_3 = \det(\mathbf{s}) = \frac{1}{3}\text{tr}(\mathbf{s}^3) = s_1 s_2 s_3
$$

$J_1$ 恒为零是因为偏应力的定义就是把平均应力减掉了，所以它的"迹"（三个对角元素之和）自然为零。

##### $J_2$ 的多种等价表达式

$J_2$ 是塑性力学中最重要的不变量，它有多种等价的表达形式，每一种在不同场合都有用：

**用偏应力主值表示**：
$$
J_2 = \frac{1}{2}(s_1^2 + s_2^2 + s_3^2)
$$

**用偏应力分量表示**（Einstein 求和约定）：
$$
J_2 = \frac{1}{2}s_{ij}s_{ij} = \frac{1}{2}(s_{11}^2 + s_{22}^2 + s_{33}^2 + 2s_{12}^2 + 2s_{23}^2 + 2s_{31}^2)
$$

**用主应力表示**（消去偏应力）：
$$
J_2 = \frac{1}{6}\left[(\sigma_1 - \sigma_2)^2 + (\sigma_2 - \sigma_3)^2 + (\sigma_3 - \sigma_1)^2\right]
$$

**用应力分量直接表示**：
$$
J_2 = \frac{1}{6}\left[(\sigma_{11} - \sigma_{22})^2 + (\sigma_{22} - \sigma_{33})^2 + (\sigma_{33} - \sigma_{11})^2\right] + \sigma_{12}^2 + \sigma_{23}^2 + \sigma_{31}^2
$$

最后一个表达式在编程实现时特别有用，因为它直接使用应力张量的 6 个分量，不需要先求主应力或偏应力。

### 3.2 J2 塑性（von Mises）的数学表述

#### 3.2.1 屈服函数

von Mises 屈服准则的核心思想是：**材料屈服由偏应力的"大小"决定，与静水压力无关。**

数学上，我们用 $J_2$ 来度量偏应力的大小，于是屈服函数写为：

$$
\boxed{f(\boldsymbol{\sigma}) = \sqrt{3J_2} - \sigma_Y = 0}
$$

或者等价地：

$$
f(\boldsymbol{\sigma}) = \bar{\sigma} - \sigma_Y = 0
$$

其中：
- $\bar{\sigma} = \sqrt{3J_2} = \sqrt{\frac{3}{2}s_{ij}s_{ij}}$ 是 **von Mises 等效应力**（也叫 Mises 应力）。
- $\sigma_Y$ 是**单轴屈服强度**，即单轴拉伸试验测得的屈服应力。

> **为什么是 $\sqrt{3}$？**
> 
> 这个系数是为了让 von Mises 等效应力在单轴拉伸情况下恰好等于轴向应力。
> 
> 对于单轴拉伸 $\sigma_1 = \sigma, \sigma_2 = \sigma_3 = 0$：
> $$J_2 = \frac{1}{6}[(\sigma - 0)^2 + (0 - 0)^2 + (0 - \sigma)^2] = \frac{\sigma^2}{3}$$
> $$\bar{\sigma} = \sqrt{3J_2} = \sqrt{3 \cdot \frac{\sigma^2}{3}} = \sigma$$
> 
> 完美！

#### 3.2.2 另一种常见形式

在某些教材和软件中，为了避免开根号（在求导时会带来 $1/(2\sqrt{J_2})$ 的麻烦），屈服函数也写成：

$$
f(\boldsymbol{\sigma}) = J_2 - k^2 = 0
$$

其中 $k = \sigma_Y / \sqrt{3}$ 是**纯剪切屈服强度**。

这两种形式在数学上是等价的（它们定义了同一个屈服面），但在数值实现的某些细节上会有微小差别。

#### 3.2.3 屈服函数对应力的导数

在后续的算法实现中，我们需要计算屈服函数对应力张量的导数 $\partial f / \partial \boldsymbol{\sigma}$。这个导数定义了**屈服面的法向方向**。

对于 $f = \sqrt{3J_2} - \sigma_Y$，我们有：

$$
\frac{\partial f}{\partial \boldsymbol{\sigma}} = \sqrt{3} \cdot \frac{\partial \sqrt{J_2}}{\partial \boldsymbol{\sigma}} = \sqrt{3} \cdot \frac{1}{2\sqrt{J_2}} \cdot \frac{\partial J_2}{\partial \boldsymbol{\sigma}}
$$

而 $J_2 = \frac{1}{2}s_{ij}s_{ij}$，所以：

$$
\frac{\partial J_2}{\partial \sigma_{kl}} = \frac{\partial J_2}{\partial s_{ij}} \cdot \frac{\partial s_{ij}}{\partial \sigma_{kl}} = s_{ij} \cdot \left(\delta_{ik}\delta_{jl} - \frac{1}{3}\delta_{ij}\delta_{kl}\right) = s_{kl}
$$

（这里用到了 $\frac{\partial s_{ij}}{\partial \sigma_{kl}} = \mathbb{I}^{dev}_{ijkl} = \delta_{ik}\delta_{jl} - \frac{1}{3}\delta_{ij}\delta_{kl}$，即偏应力投影张量。）

因此：

$$
\frac{\partial f}{\partial \boldsymbol{\sigma}} = \frac{\sqrt{3}}{2\sqrt{J_2}} \mathbf{s} = \frac{3}{2\bar{\sigma}} \mathbf{s}
$$

定义**归一化偏应力方向**：

$$
\mathbf{n} = \frac{\mathbf{s}}{\|\mathbf{s}\|} = \frac{\mathbf{s}}{\sqrt{2J_2}}
$$

则：

$$
\boxed{\frac{\partial f}{\partial \boldsymbol{\sigma}} = \sqrt{\frac{3}{2}} \mathbf{n}}
$$

**关键观察**：$\partial f / \partial \boldsymbol{\sigma}$ **完全没有静水压力分量**！它只有偏应力方向的分量。这意味着屈服面的法向始终垂直于静水压力轴——这正是圆柱面的特征。 （注意可微分FEM中AD会自动求解此值，无需任何数学推导）


### 3.3 Drucker-Prager 塑性的数学表述

#### 3.3.1 屈服函数

Drucker-Prager 屈服准则在 von Mises 的基础上引入了对静水压力的依赖：

$$
\boxed{f(\boldsymbol{\sigma}) = \sqrt{J_2} + \alpha I_1 - k = 0}
$$

其中：
- $\sqrt{J_2}$：偏应力的大小（注意这里没有 $\sqrt{3}$ 系数）。
- $I_1 = \sigma_1 + \sigma_2 + \sigma_3$：第一应力不变量。
- $\alpha$：**摩擦参数**，控制屈服面对静水压力的敏感程度（即圆锥的张角）。
- $k$：**黏聚参数**，控制屈服面的"初始大小"。


#### 3.3.2 圆锥顶点的位置

当 $\sqrt{J_2} = 0$（即纯静水应力状态，没有任何剪切）时，屈服条件变为：

$$
\alpha I_1 - k = 0 \quad \Rightarrow \quad I_1 = \frac{k}{\alpha}
$$

这个点就是**圆锥的顶点（Apex）**。在主应力空间中，它位于静水压力轴上，坐标为 $(\sigma_a, \sigma_a, \sigma_a)$，其中：

$$
\sigma_a = \frac{I_1}{3} = \frac{k}{3\alpha}
$$

由于我们采用拉正压负的约定，$\alpha > 0$ 且 $k > 0$，所以 $\sigma_a > 0$，顶点在**拉伸侧**。

**物理意义**：顶点位置 $I_1 = k/\alpha$ 对应于材料的**静水拉伸强度**。当材料受到足够大的均匀拉伸（三个主应力都相等且为正）时，即使没有任何剪切，材料也会破坏。这对应于脆性材料（如混凝土、岩石）的拉伸断裂行为。

#### 3.3.3 圆锥的张角

圆锥的张角由参数 $\alpha$ 决定。从屈服面方程 $\sqrt{J_2} = k - \alpha I_1$ 可以看出，$\alpha$ 是 $\sqrt{J_2}$ 对 $I_1$ 的"斜率"（的负值）。

设圆锥半角为 $\theta$（圆锥母线与轴线的夹角），则在子午线（$\sqrt{J_2}$ vs $I_1$ 图）上：

$$
\tan\theta = \left|\frac{d(\sqrt{J_2})}{dI_1}\right| = \alpha
$$

所以：

$$
\theta = \arctan(\alpha)
$$

$\alpha$ 越大，张角越大，圆锥越"胖"，材料对静水压力越敏感。

#### 3.3.4 屈服函数对应力的导数

对于 $f = \sqrt{J_2} + \alpha I_1 - k$，我们计算：

$$
\frac{\partial f}{\partial \boldsymbol{\sigma}} = \frac{\partial \sqrt{J_2}}{\partial \boldsymbol{\sigma}} + \alpha \frac{\partial I_1}{\partial \boldsymbol{\sigma}}
$$

我们已经知道：

$$
\frac{\partial \sqrt{J_2}}{\partial \boldsymbol{\sigma}} = \frac{1}{2\sqrt{J_2}} \cdot \mathbf{s} = \frac{\mathbf{s}}{2\sqrt{J_2}}
$$

而 $I_1 = \text{tr}(\boldsymbol{\sigma}) = \sigma_{kk}$，所以：

$$
\frac{\partial I_1}{\partial \sigma_{ij}} = \delta_{ij} \quad \Rightarrow \quad \frac{\partial I_1}{\partial \boldsymbol{\sigma}} = \mathbf{I}
$$

因此：

$$
\boxed{\frac{\partial f}{\partial \boldsymbol{\sigma}} = \frac{\mathbf{s}}{2\sqrt{J_2}} + \alpha \mathbf{I}}
$$

**关键观察**：与 von Mises 不同，Drucker-Prager 的屈服面法向**包含静水压力分量** $\alpha \mathbf{I}$！

这个 $\alpha \mathbf{I}$ 项意味着屈服面的法向不再垂直于静水压力轴，而是朝着拉伸方向（$I_1$ 增加的方向）倾斜。这正是圆锥面的几何特征。

#### 3.3.5 与 von Mises 的数学对比

让我们把两个模型的关键数学表达式放在一起比较：

| 数学量                                          | J2 (von Mises)                                      | Drucker-Prager                                                            |
| ----------------------------------------------- | --------------------------------------------------- | ------------------------------------------------------------------------- |
| **屈服函数** $f$                                | $\sqrt{3J_2} - \sigma_Y$                            | $\sqrt{J_2} + \alpha I_1 - k$                                             |
| **对 $J_2$ 的依赖**                             | $\sqrt{J_2}$                                        | $\sqrt{J_2}$                                                              |
| **对 $I_1$ 的依赖**                             | **无**                                              | **线性** ($\alpha I_1$)                                                   |
| **$\partial f / \partial \boldsymbol{\sigma}$** | $\frac{3\mathbf{s}}{2\bar{\sigma}}$（纯偏应力方向） | $\frac{\mathbf{s}}{2\sqrt{J_2}} + \alpha \mathbf{I}$（偏应力 + 静水方向） |
| **$\partial f / \partial I_1$**                 | $0$                                                 | $\alpha$                                                                  |

### 3.4 参数转换：从 Mohr-Coulomb 到 Drucker-Prager

在工程实践中，岩土材料的强度参数通常以 **Mohr-Coulomb 准则**的形式给出：

$$
\tau_f = c + \sigma_n \tan\phi
$$

其中：
- $\tau_f$：破坏时的剪应力。
- $\sigma_n$：法向应力（正压力为正）。
- $c$：**黏聚力（Cohesion）**。
- $\phi$：**内摩擦角（Internal Friction Angle）**。

Mohr-Coulomb 准则在主应力空间中的屈服面是一个**不规则的六角锥**——它的偏平面截面是六边形，而不是圆形。这给数值计算带来了麻烦（角点处导数不连续）。

Drucker-Prager 准则可以看作是 Mohr-Coulomb 的**光滑近似**——用圆锥代替六角锥。但问题是：如何选择 DP 参数 $(\alpha, k)$ 以"最佳匹配" MC 参数 $(c, \phi)$？

答案是：**没有唯一的"最佳"方式**。不同的匹配条件会给出不同的转换公式。

#### 3.4.1 三种常见的匹配方式

**【图示建议】**

> **图3-1：Drucker-Prager 圆锥与 Mohr-Coulomb 六角锥的匹配**
> 
> 图片展示偏平面（$\pi$ 平面）上的俯视图。
> 
> - 画出 Mohr-Coulomb 的**不规则六边形**截面（浅灰色填充）。
> - 画出三个不同大小的**圆形**，分别代表：
>   - **外切圆**（最大圆，红色虚线）：与六边形的六个顶点相切。
>   - **内切圆**（最小圆，蓝色虚线）：与六边形的六条边相切。
>   - **中间圆**（绿色虚线）：某种"平均"匹配。
> - 标注六边形的六个顶点对应的主应力排列顺序（如 $\sigma_1 > \sigma_2 > \sigma_3$ 等）。
> 
> 图的标题：**偏平面上 Drucker-Prager 圆与 Mohr-Coulomb 六边形的三种匹配方式**

##### (1) 外接匹配（匹配三轴压缩，TC）

让 DP 圆锥**外切于** MC 六角锥（圆通过六边形的顶点）。

这种匹配在**三轴压缩**（$\sigma_1 = \sigma_2 > \sigma_3$，或 $\sigma_1 > \sigma_2 = \sigma_3$）条件下给出与 MC 相同的强度。

转换公式：

$$
\alpha = \frac{2\sin\phi}{\sqrt{3}(3 - \sin\phi)}, \quad k = \frac{6c\cos\phi}{\sqrt{3}(3 - \sin\phi)}
$$

##### (2) 内接匹配（匹配三轴拉伸，TE）

让 DP 圆锥**内切于** MC 六角锥（圆与六边形的边相切）。

这种匹配在**三轴拉伸**条件下给出与 MC 相同的强度。

转换公式：

$$
\alpha = \frac{2\sin\phi}{\sqrt{3}(3 + \sin\phi)}, \quad k = \frac{6c\cos\phi}{\sqrt{3}(3 + \sin\phi)}
$$

##### (3) 平面应变匹配

让 DP 在**平面应变**条件下给出与 MC 相同的强度。这在隧道、挡土墙等平面应变问题中最为常用。

转换公式：

$$
\alpha = \frac{\tan\phi}{\sqrt{9 + 12\tan^2\phi}}, \quad k = \frac{3c}{\sqrt{9 + 12\tan^2\phi}}
$$

#### 3.4.2 匹配方式的选择建议

| 问题类型           | 推荐匹配方式   | 理由                   |
| ------------------ | -------------- | ---------------------- |
| 基坑开挖、边坡稳定 | 平面应变匹配   | 问题本身近似平面应变   |
| 桩基承载力         | 外接匹配（TC） | 桩周土体主要受三轴压缩 |
| 地基隆起破坏       | 内接匹配（TE） | 涉及土体的被动侧向挤出 |
| 保守设计           | 内接匹配（TE） | 给出最小强度，偏安全   |

> **实用提醒**：在使用商业软件时，务必查阅文档，确认软件采用的默认匹配方式。有些软件（如 ABAQUS）允许用户直接输入 $\alpha$ 和 $k$，也允许输入 $c$ 和 $\phi$ 并选择匹配方式。


### 3.5 超越线性：$J_3$ 与 Lode 角

细心的读者可能已经注意到，我们在构造 DP 屈服函数时只用到了 $I_1$ 和 $J_2$，而没有用到 $I_2$、$I_3$ 或 $J_3$。

这是有意为之的简化。$J_2$ 型模型（包括 von Mises 和基本的 Drucker-Prager）假设材料在偏平面上是**各向同性**的——无论剪切方向如何，屈服强度都一样。这导致偏平面截面是正圆。

但真实的岩土材料往往不满足这个假设。实验表明，很多材料在**三轴压缩**（$\sigma_1 > \sigma_2 = \sigma_3$）和**三轴拉伸**（$\sigma_1 = \sigma_2 > \sigma_3$）下的强度是不同的。Mohr-Coulomb 的六边形截面正是为了捕捉这种差异。

为了在保持光滑的同时捕捉这种"非圆"效应，更高级的模型会引入**第三偏应力不变量 $J_3$** 或等价的 **Lode 角 $\theta_L$**：

$$
\cos(3\theta_L) = \frac{3\sqrt{3}}{2} \frac{J_3}{J_2^{3/2}}
$$

Lode 角 $\theta_L$ 描述了应力状态在偏平面上的"方位"——它区分了压缩子午线（$\theta_L = 0°$）和拉伸子午线（$\theta_L = 60°$）。

引入 $J_3$ 或 $\theta_L$ 后，屈服面在偏平面上的截面可以变成圆角六边形、圆角三角形或其他光滑的非圆形状。这类模型包括：

- **Matsuoka-Nakai 准则**
- **Lade-Duncan 准则**
- **广义 Drucker-Prager（带 $J_3$ 修正）**

这些模型超出了本文的范围，但知道它们的存在是有价值的——当你发现基本 DP 模型与实验数据吻合不好时，可能需要考虑这些更复杂的选项。

### 3.6 本节小结

在这一部分，我们深入了屈服函数的数学内核：

1.  **应力不变量**是构造屈服函数的基本构建块。$I_1$ 描述体积变化，$J_2$ 描述形状改变。

2.  **J2 (von Mises) 屈服函数** $f = \sqrt{3J_2} - \sigma_Y$ 只依赖于 $J_2$，对 $I_1$ 完全不敏感。其法向 $\partial f / \partial \boldsymbol{\sigma}$ 是纯偏应力方向，没有静水分量。

3.  **Drucker-Prager 屈服函数** $f = \sqrt{J_2} + \alpha I_1 - k$ 同时依赖于 $J_2$ 和 $I_1$。其法向包含静水分量 $\alpha \mathbf{I}$，这使得屈服面是倾斜的圆锥而非垂直的圆柱。

4.  **参数转换**：DP 参数 $(\alpha, k)$ 可以从 Mohr-Coulomb 参数 $(c, \phi)$ 转换得到，但转换公式取决于匹配条件（三轴压缩、三轴拉伸或平面应变）。

5.  **局限性**：基本的 DP 模型假设偏平面截面为正圆，无法区分压缩与拉伸强度的差异。引入 $J_3$ 可以克服这一局限。

掌握了这些数学基础，我们就可以进入下一个关键话题：**流动法则与体积变形**——这是 J2 与 DP 在物理行为上最深刻的差异所在。

---

<!-- TAB_BREAK: 物理机制 -->

## 第四部分：物理机制——体积改变的秘密

### 4.1 一个被忽视的关键问题：塑性变形的方向

在前几部分，我们花了大量篇幅讨论**屈服条件**——材料什么时候开始产生塑性变形。但这只是故事的一半。

一旦材料屈服了，紧接着的问题是：**塑性变形往哪个方向发展？发展多少？**

想象你用力捏一块橡皮泥，它开始流动了。但它是均匀地向四周膨胀？还是只在某个特定方向上变形？或者体积根本不变，只是形状改变？

这些问题的答案，由**流动法则（Flow Rule）**给出。

流动法则是塑性力学中与屈服准则同等重要的概念，但在入门教材中往往被草草带过。然而，正是流动法则的差异，造成了 J2 和 Drucker-Prager 模型在物理行为上最本质的区别——**塑性体积变形**。

### 4.2 流动法则：塑性应变增量的方向

#### 4.2.1 基本概念

在塑性变形过程中，**塑性应变增量 $d\boldsymbol{\varepsilon}^p$** 的方向由一个标量函数——**塑性势函数（Plastic Potential Function）** $g(\boldsymbol{\sigma})$——的梯度决定：

$$
d\boldsymbol{\varepsilon}^p = d\lambda \frac{\partial g}{\partial \boldsymbol{\sigma}}
$$

其中：
- $d\lambda \geq 0$ 是**塑性乘子（Plastic Multiplier）**，一个非负标量，控制塑性应变的"大小"。
- $\frac{\partial g}{\partial \boldsymbol{\sigma}}$ 是塑性势函数对应力的梯度，定义了塑性应变增量的"方向"。

这个公式的几何意义是：**塑性应变增量的方向垂直于塑性势面 $g = \text{const}$**。

#### 4.2.2 关联流动 vs 非关联流动

根据塑性势函数 $g$ 与屈服函数 $f$ 的关系，流动法则分为两类：

**关联流动法则（Associative Flow Rule）**：
$$
g = f
$$

即塑性势函数与屈服函数相同。此时，塑性应变增量的方向垂直于**屈服面**：

$$
d\boldsymbol{\varepsilon}^p = d\lambda \frac{\partial f}{\partial \boldsymbol{\sigma}}
$$

**非关联流动法则（Non-associative Flow Rule）**：
$$
g \neq f
$$

即塑性势函数与屈服函数不同。此时，塑性应变增量的方向垂直于一个不同于屈服面的**塑性势面**。

**【图示建议】**

> **图4-1：关联流动与非关联流动的几何意义**
> 
> 图片展示二维应力空间（如 $\sigma_1$ - $\sigma_2$ 平面）中的屈服面和塑性势面。
> 
> **左图（关联流动）**：
> - 画一条封闭曲线代表屈服面 $f = 0$。
> - 在曲线上某点 $P$ 画出**外法向量** $\mathbf{n}$，标注为"$\partial f / \partial \boldsymbol{\sigma}$"。
> - 画一个小箭头代表塑性应变增量 $d\boldsymbol{\varepsilon}^p$，与法向量同向。
> - 注释："塑性应变增量垂直于屈服面"。
> 
> **右图（非关联流动）**：
> - 画两条封闭曲线：实线为屈服面 $f = 0$，虚线为塑性势面 $g = 0$。
> - 在屈服面上某点 $P$，画出屈服面的法向量（浅灰色）和塑性势面在同一应力状态下的法向量（红色箭头），两者方向不同。
> - 塑性应变增量 $d\boldsymbol{\varepsilon}^p$ 沿红色箭头方向。
> - 注释："塑性应变增量垂直于塑性势面，而非屈服面"。
> 
> 图的标题：**关联流动 vs 非关联流动：塑性应变增量的方向**

#### 4.2.3 为什么要区分这两种流动法则？

对于金属等材料，关联流动法则是一个很好的近似，而且它有一些优美的数学性质（如最大塑性功原理、唯一性定理等）。

但对于岩土材料，关联流动法则往往会给出**严重偏离实验的结果**——尤其是在体积变形方面。这就是为什么 Drucker-Prager 模型通常需要配合非关联流动法则使用。

让我们深入探讨这个问题。

### 4.3 J2 塑性的流动法则：体积不变的奥秘

#### 4.3.1 关联流动法则下的塑性应变增量

对于 J2 (von Mises) 塑性，我们采用关联流动法则 $g = f$：

$$
f = \sqrt{3J_2} - \sigma_Y
$$

在第三部分，我们已经计算过：

$$
\frac{\partial f}{\partial \boldsymbol{\sigma}} = \frac{3\mathbf{s}}{2\bar{\sigma}} = \sqrt{\frac{3}{2}} \mathbf{n}
$$

其中 $\mathbf{n} = \mathbf{s}/\|\mathbf{s}\|$ 是归一化的偏应力方向，$\bar{\sigma} = \sqrt{3J_2}$ 是 von Mises 等效应力。

因此，塑性应变增量为：

$$
d\boldsymbol{\varepsilon}^p = d\lambda \frac{\partial f}{\partial \boldsymbol{\sigma}} = d\lambda \cdot \frac{3\mathbf{s}}{2\bar{\sigma}}
$$

**关键观察**：$d\boldsymbol{\varepsilon}^p$ 与偏应力 $\mathbf{s}$ **同向**。

#### 4.3.2 塑性体积应变为零的证明

塑性体积应变增量定义为塑性应变张量的迹：

$$
d\varepsilon^p_v = \text{tr}(d\boldsymbol{\varepsilon}^p) = d\varepsilon^p_{11} + d\varepsilon^p_{22} + d\varepsilon^p_{33}
$$

对于 J2 塑性：

$$
d\varepsilon^p_v = \text{tr}\left(d\lambda \cdot \frac{3\mathbf{s}}{2\bar{\sigma}}\right) = d\lambda \cdot \frac{3}{2\bar{\sigma}} \cdot \text{tr}(\mathbf{s})
$$

而偏应力张量的迹恒为零：

$$
\text{tr}(\mathbf{s}) = s_1 + s_2 + s_3 = (\sigma_1 - \sigma_m) + (\sigma_2 - \sigma_m) + (\sigma_3 - \sigma_m) = I_1 - 3\sigma_m = 0
$$

因此：

$$
\boxed{d\varepsilon^p_v = 0}
$$

**结论**：在 J2 塑性模型下，**塑性变形不产生体积变化**。材料只发生形状改变（剪切变形），总体积保持不变。

这就是为什么金属在拉伸时会变细、在压缩时会变粗——但总的"肉量"不变。这个性质叫做**塑性不可压缩性（Plastic Incompressibility）**。

#### 4.3.3 几何直观

让我们从几何角度理解这个结果。

在主应力空间中，J2 屈服面是一个圆柱，其轴线是静水压力轴。

屈服面的法向量 $\partial f / \partial \boldsymbol{\sigma}$（也就是塑性应变增量的方向）**始终垂直于圆柱的轴线**——它指向圆柱的"径向"，而不是"轴向"。

"径向"对应的是偏应力方向（形状改变），"轴向"对应的是静水压力方向（体积改变）。

由于塑性应变增量没有"轴向"分量，所以塑性变形不改变体积。

**【图示建议】**

> **图4-2：J2 塑性的流动方向——圆柱面的法向**
> 
> 图片展示三维主应力空间中的 von Mises 圆柱面。
> 
> - 在圆柱面上取一点 $P$（代表当前应力状态）。
> - 从 $P$ 点画出**外法向量**（红色箭头），标注为"$\partial f / \partial \boldsymbol{\sigma} = d\boldsymbol{\varepsilon}^p$ 方向"。
> - 关键：法向量**水平**（垂直于静水压力轴），指向远离轴心的方向。
> - 用虚线标注静水压力轴，旁边注释："沿此轴方向的分量 = 0（无塑性体积应变）"。
> 
> 图的标题：**J2 塑性：法向量垂直于静水压力轴，塑性体积应变为零**

### 4.4 Drucker-Prager 的流动法则：关联流动的困境

#### 4.4.1 关联流动法则下的塑性应变增量

如果我们对 Drucker-Prager 也采用关联流动法则 $g = f$：

$$
f = \sqrt{J_2} + \alpha I_1 - k
$$

在第三部分，我们计算过：

$$
\frac{\partial f}{\partial \boldsymbol{\sigma}} = \frac{\mathbf{s}}{2\sqrt{J_2}} + \alpha \mathbf{I}
$$

塑性应变增量为：

$$
d\boldsymbol{\varepsilon}^p = d\lambda \left( \frac{\mathbf{s}}{2\sqrt{J_2}} + \alpha \mathbf{I} \right)
$$

#### 4.4.2 塑性体积应变不为零

计算塑性体积应变增量：

$$
d\varepsilon^p_v = \text{tr}(d\boldsymbol{\varepsilon}^p) = d\lambda \left( \frac{\text{tr}(\mathbf{s})}{2\sqrt{J_2}} + \alpha \cdot \text{tr}(\mathbf{I}) \right)
$$

由于 $\text{tr}(\mathbf{s}) = 0$ 且 $\text{tr}(\mathbf{I}) = 3$：

$$
\boxed{d\varepsilon^p_v = 3\alpha \cdot d\lambda}
$$

由于 $\alpha > 0$（对于摩擦性材料）且 $d\lambda \geq 0$，我们有：

$$
d\varepsilon^p_v \geq 0
$$

**结论**：在 Drucker-Prager 关联流动法则下，**塑性变形总是伴随着体积膨胀**。而且，膨胀的程度由摩擦参数 $\alpha$ 控制——$\alpha$ 越大（摩擦角越大），膨胀越剧烈。

#### 4.4.3 几何直观

在主应力空间中，DP 屈服面是一个圆锥。圆锥面的法向量**不垂直于静水压力轴**，而是朝向"外上方"——既有径向分量（偏应力方向），也有轴向分量（静水压力方向）。

轴向分量的存在意味着塑性应变增量有体积分量，即塑性变形会导致体积变化。

由于圆锥是向压缩方向（$I_1$ 减小方向）张开的，其外法向量的轴向分量指向拉伸方向（$I_1$ 增大方向）。在应变空间，这对应于**体积膨胀**。

**【图示建议】**

> **图4-3：Drucker-Prager 关联流动的法向——圆锥面的法向**
> 
> 图片展示三维主应力空间中的 DP 圆锥面。
> 
> - 在圆锥面上取一点 $P$。
> - 从 $P$ 点画出**外法向量**（红色箭头），标注为"$\partial f / \partial \boldsymbol{\sigma}$"。
> - 关键：法向量**倾斜向上**（朝向拉伸侧），既有径向分量也有轴向分量。
> - 将法向量分解为两个分量：
>   - 偏应力方向分量（水平，蓝色）：$\mathbf{s}/(2\sqrt{J_2})$
>   - 静水方向分量（沿轴，绿色）：$\alpha \mathbf{I}$
> - 旁边注释："轴向分量 $\neq 0$ → 塑性体积应变 $\neq 0$"
> 
> 图的标题：**Drucker-Prager 关联流动：法向量有静水分量，导致塑性体积膨胀**

#### 4.4.4 问题来了：膨胀过度！

关联流动法则给 DP 模型带来了一个严重的问题：**预测的体积膨胀远超实验观测**。

让我们做一个简单的估算。

对于典型的砂土，内摩擦角 $\phi \approx 30°$，对应的 DP 参数（外接匹配）：$\alpha \approx 0.23$。

塑性体积应变率与塑性剪切应变率的比值叫做**剪胀率**，对于关联流动：

$$
\frac{d\varepsilon^p_v}{d\gamma^p} = \frac{3\alpha \cdot d\lambda}{\sqrt{3J_2}/(J_2) \cdot d\lambda} \approx \tan\phi_{\text{dil}}
$$

按照关联流动，剪胀角 $\psi$ 等于摩擦角 $\phi$，即 $\psi = \phi \approx 30°$。

但实验表明，真实砂土的剪胀角通常只有 **5° ~ 15°**，远小于摩擦角！

这意味着，如果使用关联流动的 DP 模型，计算出的土体膨胀量可能是实际值的 2~5 倍。这在工程上是不可接受的——比如，你会错误地高估基坑开挖引起的地表隆起，或者错误地低估桩基的沉降。

### 4.5 非关联流动：剪胀角的引入

为了解决关联流动的过度膨胀问题，我们需要采用**非关联流动法则**——让塑性势函数 $g$ 与屈服函数 $f$ 不同。

#### 4.5.1 构造塑性势函数

最常见的做法是：保持 $g$ 的数学形式与 $f$ 相同，但使用不同的参数。

定义**塑性势函数**：

$$
g(\boldsymbol{\sigma}) = \sqrt{J_2} + \beta I_1 - \text{const}
$$

其中 $\beta$ 是一个新的参数，称为**剪胀参数**，它控制塑性体积应变的大小。

$\beta$ 与 $\alpha$ 的关系类似于**剪胀角 $\psi$** 与**摩擦角 $\phi$** 的关系。转换公式（以外接匹配为例）：

$$
\beta = \frac{2\sin\psi}{\sqrt{3}(3 - \sin\psi)}
$$

#### 4.5.2 塑性应变增量（非关联流动）

采用非关联流动：

$$
d\boldsymbol{\varepsilon}^p = d\lambda \frac{\partial g}{\partial \boldsymbol{\sigma}} = d\lambda \left( \frac{\mathbf{s}}{2\sqrt{J_2}} + \beta \mathbf{I} \right)
$$

塑性体积应变增量：

$$
d\varepsilon^p_v = 3\beta \cdot d\lambda
$$

由于 $\beta < \alpha$（即 $\psi < \phi$），塑性体积膨胀被削弱了，更接近实验观测。

**特殊情况**：
- 当 $\psi = \phi$（即 $\beta = \alpha$）时，退化为关联流动。
- 当 $\psi = 0$（即 $\beta = 0$）时，塑性体积应变为零，这叫做**等体积流动**或**纯剪切流动**。

#### 4.5.3 剪胀角的物理意义

**剪胀角 $\psi$** 描述了材料在剪切过程中发生体积变化的倾向：

- $\psi > 0$：**剪胀（Dilatancy）**——剪切导致体积膨胀。
- $\psi = 0$：**等体积**——剪切不改变体积。
- $\psi < 0$：**剪缩（Contractancy）**——剪切导致体积收缩（较少见，主要出现在很松散的土或高围压下）。

**物理图景**：想象一堆紧密堆积的玻璃球。当你试图让这些球发生相对错动（剪切）时，它们必须先"爬"到相邻球的顶部才能滑过去。这个"爬坡"的过程导致了整体体积的膨胀。

剪胀角的大小取决于：
- **颗粒的咬合程度**：颗粒棱角越分明、堆积越紧密，剪胀越显著。
- **围压水平**：围压越高，颗粒越难"爬"起来，剪胀被抑制。
- **应变历史**：随着剪切变形的进行，颗粒排列逐渐松散，剪胀减弱，最终可能达到**临界状态（Critical State）**，此时剪胀角趋近于零。

**【图示建议】**

> **图4-4：剪胀现象的微观机制**
> 
> 图片分为上下两部分。
> 
> **上图（剪胀前）**：
> - 画出一排紧密接触的圆形颗粒（如玻璃球或沙粒），颗粒之间紧密咬合。
> - 标注初始体积 $V_0$。
> 
> **下图（剪胀后）**：
> - 对同一排颗粒施加剪切力（用水平箭头表示），颗粒发生相对错动。
> - 为了错动，颗粒必须"爬"到相邻颗粒之上，导致整体高度增加。
> - 标注新体积 $V > V_0$，旁边注释"体积膨胀 = 剪胀"。
> - 用虚线画出颗粒的运动轨迹，显示它们如何"爬坡"。
> 
> 图的标题：**剪胀的微观机制：颗粒错动必须"爬坡"，导致体积膨胀**

#### 4.5.4 剪胀角的典型取值

不同材料的剪胀角差异很大：

| 材料类型         | 摩擦角 $\phi$ | 剪胀角 $\psi$ | 备注                 |
| ---------------- | ------------- | ------------- | -------------------- |
| 松散砂土         | 28° ~ 32°     | 0° ~ 5°       | 颗粒重排为主，剪胀弱 |
| 中密砂土         | 32° ~ 36°     | 5° ~ 12°      |                      |
| 紧密砂土         | 36° ~ 42°     | 12° ~ 18°     | 颗粒咬合强，剪胀显著 |
| 黏土（正常固结） | 20° ~ 25°     | ≈ 0°          | 黏土通常假设不剪胀   |
| 超固结黏土       | 25° ~ 30°     | 5° ~ 10°      | 超固结土有一定剪胀   |
| 混凝土           | 30° ~ 37°     | 8° ~ 15°      |                      |
| 岩石             | 35° ~ 55°     | 10° ~ 20°     | 取决于节理发育程度   |

> **工程经验法则**：对于初步分析，可以取 $\psi \approx \phi - 30°$（但不小于 0°）；或者取 $\psi \approx 0.5\phi$ 到 $0.7\phi$。

### 4.6 非关联流动的代价

非关联流动虽然解决了过度剪胀的问题，但它也带来了一些理论和数值上的麻烦。

#### 4.6.1 失去最大塑性功原理

关联流动法则满足 **Drucker 稳定性假设**和**最大塑性功原理**。这些原理保证了边值问题解的唯一性和稳定性。

非关联流动法则不满足这些原理。这意味着：
- 边值问题的解**可能不唯一**——同样的边界条件可能对应多个不同的应力/应变场。
- **应变局部化**更容易发生——剪切带可以在理论上以零厚度出现，导致网格依赖性。

在实际工程分析中，这些问题通常不会太严重（因为有足够的正则化因素，如有限网格尺寸、材料的微小黏性等）。但在某些极端情况下，可能会遇到收敛困难或结果异常。

#### 4.6.2 刚度矩阵的非对称性

这是非关联流动带来的最直接的数值问题。

在有限元的 Newton-Raphson 迭代中，我们需要计算**一致切线刚度矩阵（Consistent Tangent Stiffness）**：

$$
\mathbb{C}^{ep} = \frac{\partial \boldsymbol{\sigma}}{\partial \boldsymbol{\varepsilon}}
$$

对于关联流动（$g = f$），可以证明这个刚度矩阵是**对称的**：

$$
\mathbb{C}^{ep}_{ijkl} = \mathbb{C}^{ep}_{klij}
$$

对称刚度矩阵可以使用高效的对称求解器（如 Cholesky 分解、共轭梯度法等），大大节省计算时间和内存。

但对于非关联流动（$g \neq f$），刚度矩阵一般是**非对称的**：

$$
\mathbb{C}^{ep}_{ijkl} \neq \mathbb{C}^{ep}_{klij}
$$

非对称刚度矩阵需要使用更昂贵的非对称求解器（如 LU 分解、GMRES 等），计算成本可能增加 2~4 倍。

> **软件提示**：在使用 ABAQUS 等软件时，如果采用非关联流动的材料模型，需要在步骤设置中启用**非对称刚度矩阵存储（Unsymmetric matrix storage）**，否则可能导致收敛困难或错误结果。

### 4.7 J2 与 DP 体积行为的对比总结

让我们用一张表格总结两种模型在体积变形方面的核心差异：

| 特征                            | J2 (von Mises)                   | Drucker-Prager                              |
| ------------------------------- | -------------------------------- | ------------------------------------------- |
| **流动法则类型**                | 关联                             | 通常**非关联**                              |
| **塑性势函数 $g$**              | $g = f = \sqrt{3J_2} - \sigma_Y$ | $g = \sqrt{J_2} + \beta I_1 - \text{const}$ |
| **塑性体积应变**                | **恒为零**                       | **非零**，取决于剪胀参数 $\beta$            |
| **物理含义**                    | 塑性不可压缩                     | 剪胀/剪缩                                   |
| **$\partial g / \partial I_1$** | $0$                              | $\beta$（一般 $\neq \alpha$）               |
| **刚度矩阵对称性**              | 对称                             | **非对称**（若 $\beta \neq \alpha$）        |

### 4.8 一个具体的例子：单轴压缩试验

为了让这些抽象的概念更加具体，让我们分析一个简单的例子：**单轴压缩试验**。

#### 4.8.1 问题设置

一个圆柱形试样（高度 $H$，直径 $D$），承受轴向压缩。假设试样处于均匀应力状态（忽略端部摩擦），轴向应力为 $\sigma_z$（压应力，取负值），侧向应力为零：

$$
\sigma_1 = \sigma_2 = 0, \quad \sigma_3 = \sigma_z < 0
$$

#### 4.8.2 J2 (von Mises) 模型的预测

**应力不变量**：
$$
I_1 = \sigma_z, \quad J_2 = \frac{1}{3}\sigma_z^2
$$

**屈服条件**：
$$
\bar{\sigma} = \sqrt{3J_2} = |\sigma_z| = \sigma_Y
$$

所以屈服时的轴向应力为 $\sigma_z = -\sigma_Y$（压缩）。

**塑性应变增量**（设轴向塑性应变增量为 $d\varepsilon^p_z < 0$，压缩）：

由于塑性体积应变为零：
$$
d\varepsilon^p_x + d\varepsilon^p_y + d\varepsilon^p_z = 0
$$

由于各向同性，侧向应变相等：$d\varepsilon^p_x = d\varepsilon^p_y$。

因此：
$$
2d\varepsilon^p_x + d\varepsilon^p_z = 0 \quad \Rightarrow \quad d\varepsilon^p_x = d\varepsilon^p_y = -\frac{1}{2}d\varepsilon^p_z
$$

**物理解释**：试样被轴向压缩（$d\varepsilon^p_z < 0$），同时侧向膨胀（$d\varepsilon^p_x = d\varepsilon^p_y > 0$），总体积不变。这就像挤压一块橡皮泥——压扁了就变宽了，但"肉"没少。

**塑性泊松比**（塑性变形时侧向应变与轴向应变的比值）：
$$
\nu^p = -\frac{d\varepsilon^p_x}{d\varepsilon^p_z} = \frac{1}{2}
$$

这是所有各向同性、体积不变的塑性模型的共同特征。

#### 4.8.3 Drucker-Prager 模型的预测

**应力不变量**（同上）：
$$
I_1 = \sigma_z, \quad J_2 = \frac{1}{3}\sigma_z^2
$$

**屈服条件**（采用 $f = \sqrt{J_2} + \alpha I_1 - k = 0$，注意压应力为负）：
$$
\frac{|\sigma_z|}{\sqrt{3}} + \alpha \sigma_z - k = 0
$$

$$
\frac{|\sigma_z|}{\sqrt{3}} - \alpha |\sigma_z| - k = 0 \quad (\text{因为 } \sigma_z < 0)
$$

$$
|\sigma_z| \left( \frac{1}{\sqrt{3}} - \alpha \right) = k
$$

$$
|\sigma_z|_Y = \frac{k}{\frac{1}{\sqrt{3}} - \alpha} = \frac{\sqrt{3}k}{1 - \sqrt{3}\alpha}
$$

（假设 $\alpha < 1/\sqrt{3}$，否则材料在单轴压缩下无法屈服。）

**塑性应变增量**（非关联流动，$g = \sqrt{J_2} + \beta I_1$）：

$$
d\varepsilon^p_v = 3\beta \cdot d\lambda
$$

设塑性剪切应变增量为 $d\gamma^p$，则剪胀率：

$$
\frac{d\varepsilon^p_v}{d\gamma^p} = \tan\psi
$$

由于 $d\varepsilon^p_v > 0$（膨胀），而轴向压缩对应 $d\varepsilon^p_z < 0$，我们有：

$$
d\varepsilon^p_x + d\varepsilon^p_y + d\varepsilon^p_z = d\varepsilon^p_v > 0
$$

这意味着**试样的总体积在增加**——轴向被压缩，但侧向膨胀得更多，净效果是膨胀。

**塑性泊松比**（大于 0.5）：

具体计算较为复杂（涉及分解偏应力分量），但定性结论是：

$$
\nu^p > \frac{1}{2}
$$

**物理解释**：岩土材料在压缩过程中，颗粒发生错动，体积膨胀。这与金属的行为截然不同。

### 4.9 本节小结

在这一部分，我们深入探讨了流动法则——塑性变形的"方向盘"：

1.  **流动法则**决定了塑性应变增量的方向，由塑性势函数 $g$ 的梯度定义。

2.  **关联流动**（$g = f$）数学优美，但对岩土材料会导致过度剪胀。

3.  **J2 塑性的关联流动**：$\partial f / \partial I_1 = 0$，塑性应变增量只有偏应力分量，**塑性体积应变恒为零**。这是金属"塑性不可压缩"的数学表达。

4.  **Drucker-Prager 的关联流动**：$\partial f / \partial I_1 = \alpha \neq 0$，塑性应变增量有静水分量，**塑性体积应变非零**。但关联流动预测的剪胀角等于摩擦角，远超实验值。

5.  **非关联流动**：引入独立的剪胀参数 $\beta$（或剪胀角 $\psi$），可以更准确地描述真实材料的体积变形行为。代价是**刚度矩阵非对称**，解可能不唯一。

6.  **剪胀角 $\psi$** 是描述材料剪胀特性的关键参数。对于大多数岩土材料，$0° < \psi < \phi$，需要根据实验确定或采用经验公式估计。

至此，我们已经完成了对 J2 和 Drucker-Prager 模型在理论层面的全面剖析——几何形状、数学公式、体积变形机制。

但理论再漂亮，最终还是要落到代码上。下一部分，我们将进入**数值实现**的深水区，探讨如何把这些方程变成有限元软件中真正能跑的本构子程序。

---

<!-- TAB_BREAK: 数值实现 -->

## 第五部分：数值实现——算法深水区

### 5.1 从连续方程到离散计算：本构积分问题

在有限元分析中，材料本构模型的实际计算是一个**增量问题**：

> 给定当前时刻 $t_n$ 的应力状态 $\boldsymbol{\sigma}_n$、内变量状态，以及从 $t_n$ 到 $t_{n+1}$ 的应变增量 $\Delta\boldsymbol{\varepsilon}$，求新时刻 $t_{n+1}$ 的应力状态 $\boldsymbol{\sigma}_{n+1}$ 和更新后的内变量。

这个**本构积分（Constitutive Integration）**问题是每个高斯积分点在每个载荷增量步都要执行的核心计算。关于 J2 塑性的回波映射算法（径向回归），我在之前的推文中已经详细讲过。今天我们聚焦于**Drucker-Prager 塑性的回波映射**——它比 J2 复杂得多，也更容易出错。

### 5.2 为什么 DP 的回波映射比 J2 难那么多？

在深入算法细节之前，先理解 DP 的复杂性来源：

| 特征                | J2 (von Mises)     | Drucker-Prager     |
| ------------------- | ------------------ | ------------------ |
| **体积-偏应力耦合** | 完全解耦           | **强耦合**         |
| **静水压力变化**    | 塑性校正时不变     | **同时变化**       |
| **流动方向**        | 固定（偏应力方向） | **依赖当前应力**   |
| **几何奇异性**      | 无                 | **圆锥顶点**       |
| **求解方式**        | 显式闭式解         | 需要迭代或分类讨论 |

J2 的"径向回归"之所以简单，是因为静水压力和偏应力完全独立：塑性校正只"缩放"偏应力，静水压力纹丝不动。但 DP 不同——塑性流动同时改变体积和形状，两者相互影响，必须一起求解。

更麻烦的是那个**圆锥顶点**。当应力接近顶点时，偏应力趋于零，流动方向的偏应力分量出现 $\mathbf{s}/(2\sqrt{J_2}) \to 0/0$ 的不定式，需要特殊处理。

### 5.3 DP 回波映射的完整推导

#### 5.3.1 问题设定与符号约定

**屈服函数**（采用拉正压负约定）：

$$
f(\boldsymbol{\sigma}) = \sqrt{J_2} + \alpha I_1 - k
$$

**塑性势函数**（非关联流动）：

$$
g(\boldsymbol{\sigma}) = \sqrt{J_2} + \beta I_1
$$

其中 $\beta$ 是剪胀参数。当 $\beta = \alpha$ 时退化为关联流动；当 $\beta = 0$ 时为等体积流动（无剪胀）。

**流动方向**：

$$
\mathbf{m} = \frac{\partial g}{\partial \boldsymbol{\sigma}} = \frac{\mathbf{s}}{2\sqrt{J_2}} + \beta \mathbf{I}
$$

为了后续推导方便，定义归一化偏应力方向：

$$
\hat{\mathbf{n}} = \frac{\mathbf{s}}{\|\mathbf{s}\|} = \frac{\mathbf{s}}{\sqrt{2J_2}}
$$

则流动方向可以写成：

$$
\mathbf{m} = \frac{1}{2}\sqrt{\frac{1}{2J_2}}\mathbf{s} + \beta \mathbf{I} = \frac{\hat{\mathbf{n}}}{2\sqrt{2}} \cdot \frac{1}{\sqrt[4]{J_2/2}} + \beta \mathbf{I}
$$

（这个形式太复杂了，我们还是用 $q = \sqrt{J_2}$ 来简化。）

**简化记号**：

$$
q = \sqrt{J_2}, \quad p = \frac{I_1}{3} = \sigma_m
$$

屈服函数变为：$f = q + 3\alpha p - k$。

#### 5.3.2 Step 1：弹性预测

给定上一步的应力 $\boldsymbol{\sigma}_n$ 和应变增量 $\Delta\boldsymbol{\varepsilon}$，计算试探应力：

$$
p^{\text{trial}} = p_n + K \cdot \text{tr}(\Delta\boldsymbol{\varepsilon}) = p_n + K \Delta\varepsilon_v
$$

$$
\mathbf{s}^{\text{trial}} = \mathbf{s}_n + 2G \cdot \text{dev}(\Delta\boldsymbol{\varepsilon})
$$

计算试探不变量：

$$
q^{\text{trial}} = \sqrt{\frac{1}{2}\mathbf{s}^{\text{trial}} : \mathbf{s}^{\text{trial}}}
$$

以及试探屈服函数：

$$
f^{\text{trial}} = q^{\text{trial}} + 3\alpha p^{\text{trial}} - k
$$

#### 5.3.3 Step 2：屈服判断与分类

**情况 A：弹性步**

如果 $f^{\text{trial}} \leq 0$，试探应力在屈服面内，本步是弹性的：

$$
\boldsymbol{\sigma}_{n+1} = \boldsymbol{\sigma}^{\text{trial}}, \quad \Delta\lambda = 0
$$

**情况 B：塑性步**

如果 $f^{\text{trial}} > 0$，需要进行塑性校正。但这里有两种子情况：

- **B1：光滑面回归**——应力回归到圆锥的侧面（$q_{n+1} > 0$）。
- **B2：顶点回归**——应力回归到圆锥的顶点（$q_{n+1} = 0$）。

如何判断是哪种情况？我们需要先尝试光滑面回归，再检验结果是否合理。

#### 5.3.4 Step 3A：光滑面回归

**基本方程**

塑性应变增量：

$$
\Delta\boldsymbol{\varepsilon}^p = \Delta\lambda \cdot \mathbf{m}_{n+1} = \Delta\lambda \left( \frac{\mathbf{s}_{n+1}}{2q_{n+1}} + \beta \mathbf{I} \right)
$$

应力更新（从试探应力减去塑性贡献）：

$$
\boldsymbol{\sigma}_{n+1} = \boldsymbol{\sigma}^{\text{trial}} - \mathbb{C}^e : \Delta\boldsymbol{\varepsilon}^p
$$

分解为体积和偏应力部分：

**静水压力更新**：

$$
p_{n+1} = p^{\text{trial}} - K \cdot \text{tr}(\Delta\boldsymbol{\varepsilon}^p) = p^{\text{trial}} - K \cdot 3\beta \Delta\lambda = p^{\text{trial}} - 3K\beta \Delta\lambda
$$

**偏应力更新**：

$$
\mathbf{s}_{n+1} = \mathbf{s}^{\text{trial}} - 2G \cdot \text{dev}(\Delta\boldsymbol{\varepsilon}^p) = \mathbf{s}^{\text{trial}} - 2G \Delta\lambda \cdot \frac{\mathbf{s}_{n+1}}{2q_{n+1}}
$$

注意：右边也有 $\mathbf{s}_{n+1}$ 和 $q_{n+1}$，这是一个**隐式方程**。

**关键性质：偏应力方向不变**

对于无硬化或等向硬化的 DP 模型，可以证明在回波映射过程中**偏应力方向保持不变**：

$$
\frac{\mathbf{s}_{n+1}}{\|\mathbf{s}_{n+1}\|} = \frac{\mathbf{s}^{\text{trial}}}{\|\mathbf{s}^{\text{trial}}\|} = \hat{\mathbf{n}}
$$

**证明思路**：假设 $\mathbf{s}_{n+1} = \xi \mathbf{s}^{\text{trial}}$（方向相同，只是大小不同），代入偏应力更新方程：

$$
\xi \mathbf{s}^{\text{trial}} = \mathbf{s}^{\text{trial}} - 2G \Delta\lambda \cdot \frac{\xi \mathbf{s}^{\text{trial}}}{2q_{n+1}}
$$

$$
\xi \mathbf{s}^{\text{trial}} = \mathbf{s}^{\text{trial}} - \frac{G \Delta\lambda \xi}{q_{n+1}} \mathbf{s}^{\text{trial}}
$$

$$
\xi = 1 - \frac{G \Delta\lambda \xi}{q_{n+1}}
$$

这个方程关于 $\xi$ 是标量方程，说明假设成立。$\square$

**标量化简**

利用方向不变的性质，设 $\mathbf{s}_{n+1} = \xi \mathbf{s}^{\text{trial}}$，则：

$$
q_{n+1} = \xi q^{\text{trial}}
$$

代入偏应力更新方程的标量形式：

$$
q_{n+1} = q^{\text{trial}} - G \Delta\lambda
$$

所以：

$$
\xi = \frac{q_{n+1}}{q^{\text{trial}}} = 1 - \frac{G \Delta\lambda}{q^{\text{trial}}}
$$

**求解塑性乘子**

将 $p_{n+1}$ 和 $q_{n+1}$ 的表达式代入屈服条件 $f_{n+1} = 0$：

$$
q_{n+1} + 3\alpha p_{n+1} - k = 0
$$

$$
(q^{\text{trial}} - G\Delta\lambda) + 3\alpha(p^{\text{trial}} - 3K\beta\Delta\lambda) - k = 0
$$

$$
\underbrace{(q^{\text{trial}} + 3\alpha p^{\text{trial}} - k)}_{= f^{\text{trial}}} - (G + 9K\alpha\beta)\Delta\lambda = 0
$$

解得：

$$
\boxed{\Delta\lambda = \frac{f^{\text{trial}}}{G + 9K\alpha\beta}}
$$

这是一个**闭式解**！不需要迭代。

**更新应力**

$$
q_{n+1} = q^{\text{trial}} - G\Delta\lambda
$$

$$
p_{n+1} = p^{\text{trial}} - 3K\beta\Delta\lambda
$$

$$
\mathbf{s}_{n+1} = \frac{q_{n+1}}{q^{\text{trial}}} \mathbf{s}^{\text{trial}}
$$

$$
\boldsymbol{\sigma}_{n+1} = p_{n+1} \mathbf{I} + \mathbf{s}_{n+1}
$$

**有效性检验**

光滑面回归要求 $q_{n+1} > 0$，即：

$$
q^{\text{trial}} - G\Delta\lambda > 0
$$

$$
\Delta\lambda < \frac{q^{\text{trial}}}{G}
$$

如果这个条件**不满足**，说明应力应该回归到顶点，而不是侧面。

#### 5.3.5 Step 3B：顶点回归

**何时发生顶点回归？**

当按光滑面公式计算的 $\Delta\lambda$ 满足：

$$
\Delta\lambda \geq \frac{q^{\text{trial}}}{G}
$$

或等价地：

$$
\frac{f^{\text{trial}}}{G + 9K\alpha\beta} \geq \frac{q^{\text{trial}}}{G}
$$

$$
f^{\text{trial}} \cdot G \geq q^{\text{trial}} \cdot (G + 9K\alpha\beta)
$$

$$
f^{\text{trial}} \geq q^{\text{trial}} \left(1 + \frac{9K\alpha\beta}{G}\right)
$$

这个条件可以在屈服判断后、正式计算之前检验，作为**顶点判据**。

一个更直观的等价判据：定义一个"顶点区域"的边界斜率。在子午线平面（$q$ vs $p$）上，从试探应力点到顶点 $(p_a, 0)$（其中 $p_a = k/(3\alpha)$）的连线斜率为：

$$
\text{slope} = \frac{q^{\text{trial}} - 0}{p^{\text{trial}} - p_a} = \frac{q^{\text{trial}}}{p^{\text{trial}} - k/(3\alpha)}
$$

如果这个斜率**小于**某个临界值（与流动方向有关），则进入顶点区域。

**顶点处的应力状态**

在圆锥顶点，$q = 0$，$p = p_a = k/(3\alpha)$：

$$
\boldsymbol{\sigma}_{n+1} = p_a \mathbf{I} = \frac{k}{3\alpha} \mathbf{I}
$$

这是一个**纯静水应力状态**，三个主应力相等。

**顶点处的塑性应变**

顶点处 $q = 0$，流动方向的偏应力分量 $\mathbf{s}/(2q)$ 是未定义的（$0/0$）。这是一个**奇异点**。

物理上，顶点处的塑性流动方向不再唯一确定——材料可以向任何方向"流动"，只要满足塑性功非负的条件。

数值实现中，常用的处理方法是**从应变增量反推塑性应变**：

$$
\boldsymbol{\varepsilon}^e_{n+1} = \frac{1}{E}\left[(1+\nu)\boldsymbol{\sigma}_{n+1} - \nu \cdot \text{tr}(\boldsymbol{\sigma}_{n+1})\mathbf{I}\right] = \frac{1}{E}\left[(1+\nu) - 3\nu\right] p_a \mathbf{I} = \frac{1-2\nu}{E} p_a \mathbf{I}
$$

$$
\Delta\boldsymbol{\varepsilon}^p = \Delta\boldsymbol{\varepsilon} - (\boldsymbol{\varepsilon}^e_{n+1} - \boldsymbol{\varepsilon}^e_n)
$$

**【图示建议】**

> **图5-1：Drucker-Prager 回波映射的两种情况**
> 
> 图片展示子午线平面（横轴 $p = I_1/3$，纵轴 $q = \sqrt{J_2}$）。
> 
> - 画出 DP 屈服面：一条从顶点 $(k/(3\alpha), 0)$ 出发、向左下方延伸的直线（斜率为 $-3\alpha$）。
> - 标出顶点位置，注释为"Apex: $(p_a, 0)$"。
> - 画出两个试探应力点：
>   - **点 A**（在"光滑面区域"）：从 A 画箭头到屈服面侧面上的点 A'，箭头方向应该与塑性势面的法向一致（斜向左下）。
>   - **点 B**（在"顶点区域"）：从 B 画箭头直接指向顶点。
> - 用虚线从顶点画一条分界线，将屈服面外部分为"光滑面回归区"和"顶点回归区"。分界线的斜率与非关联流动的方向有关。
> - 在分界线旁边注释判据公式。
> 
> 图的标题：**DP 回波映射：光滑面回归 vs 顶点回归**

### 5.4 DP 回波映射的完整算法

```algorithm

    输入: σ_n, ε^p_n, Δε, 材料参数 (K, G, α, β, k)
    输出: σ_{n+1}, ε^p_{n+1}, Δλ, 回归类型

    // ========== Step 1: 弹性预测 ==========
    Δε_v = tr(Δε)
    Δe = dev(Δε)

    p_trial = p_n + K * Δε_v
    s_trial = s_n + 2*G * Δe
    q_trial = sqrt(0.5 * s_trial : s_trial)

    // ========== Step 2: 屈服判断 ==========
    f_trial = q_trial + 3*α*p_trial - k

    IF f_trial ≤ 0 THEN
        // 弹性步
        σ_{n+1} = p_trial*I + s_trial
        ε^p_{n+1} = ε^p_n
        Δλ = 0
        RETURN (σ_{n+1}, ε^p_{n+1}, Δλ, "ELASTIC")
    END IF

    // ========== Step 3: 塑性校正 ==========
    // 计算塑性乘子（假设光滑面回归）
    H_bar = G + 9*K*α*β
    Δλ = f_trial / H_bar

    // 检验是否需要顶点回归
    q_new = q_trial - G*Δλ

    IF q_new > TOL THEN
        // ===== 光滑面回归 =====
        p_{n+1} = p_trial - 3*K*β*Δλ
        q_{n+1} = q_new
    
        // 偏应力按比例缩放
        IF q_trial > TOL THEN
            s_{n+1} = (q_{n+1} / q_trial) * s_trial
        ELSE
            s_{n+1} = 0
        END IF
    
        σ_{n+1} = p_{n+1}*I + s_{n+1}
    
        // 更新塑性应变
        n_hat = s_trial / (2*q_trial)  // 偏应力流动方向
        Δε^p = Δλ * (n_hat + β*I)
        ε^p_{n+1} = ε^p_n + Δε^p
    
        RETURN (σ_{n+1}, ε^p_{n+1}, Δλ, "SMOOTH")
    
    ELSE
        // ===== 顶点回归 =====
        p_apex = k / (3*α)
        σ_{n+1} = p_apex * I  // 纯静水应力
    
        // 从弹性应变反推塑性应变
        ε^e_{n+1} = (1-2*ν)/(3*K) * p_apex * I  // 或用完整公式
        Δε^e = ε^e_{n+1} - ε^e_n
        Δε^p = Δε - Δε^e
        ε^p_{n+1} = ε^p_n + Δε^p
    
        // 塑性乘子（可选计算，用于后处理）
        Δλ = ... // 从塑性应变反推
    
        RETURN (σ_{n+1}, ε^p_{n+1}, Δλ, "APEX")
    END IF

```

### 5.5 一致切线刚度

一致切线刚度（Consistent Tangent）是保证 Newton-Raphson 二次收敛的关键。对于 DP 模型，它比 J2 复杂得多。

#### 5.5.1 光滑面回归的一致切线刚度

**弹性情况**：

$$
\mathbb{C}^{ep} = \mathbb{C}^e = K \mathbf{I} \otimes \mathbf{I} + 2G \mathbb{I}^{\text{dev}}
$$

**塑性情况**（光滑面）：

通过对应力更新公式求全微分，可以得到：

$$
\mathbb{C}^{ep} = \mathbb{C}^e - \frac{1}{\bar{H}} (\mathbf{a} \otimes \mathbf{b})
$$

其中：

$$
\bar{H} = G + 9K\alpha\beta
$$

$$
\mathbf{a} = 2G \cdot \frac{\mathbf{s}^{\text{trial}}}{2q^{\text{trial}}} + 3K\beta \mathbf{I} = G \frac{\mathbf{s}^{\text{trial}}}{q^{\text{trial}}} + 3K\beta \mathbf{I}
$$

$$
\mathbf{b} = 2G \cdot \frac{\mathbf{s}^{\text{trial}}}{2q^{\text{trial}}} + 3K\alpha \mathbf{I} = G \frac{\mathbf{s}^{\text{trial}}}{q^{\text{trial}}} + 3K\alpha \mathbf{I}
$$

更完整的形式（考虑偏应力的"几何软化"）：

$$
\mathbb{C}^{ep} = K \mathbf{I} \otimes \mathbf{I} + 2G\theta \left(\mathbb{I}^{\text{dev}} - \hat{\mathbf{n}} \otimes \hat{\mathbf{n}}\right) + 2G\theta' \hat{\mathbf{n}} \otimes \hat{\mathbf{n}} - \frac{1}{\bar{H}} (\mathbf{a} \otimes \mathbf{b})
$$

其中 $\theta = q_{n+1}/q^{\text{trial}}$ 是偏应力的缩放因子。

**非对称性**

注意 $\mathbf{a}$ 和 $\mathbf{b}$ 的区别在于：$\mathbf{a}$ 含有 $\beta$（塑性势参数），$\mathbf{b}$ 含有 $\alpha$（屈服函数参数）。

当 $\alpha \neq \beta$（非关联流动）时：

$$
\mathbf{a} \otimes \mathbf{b} \neq (\mathbf{a} \otimes \mathbf{b})^T = \mathbf{b} \otimes \mathbf{a}
$$

所以刚度矩阵是**非对称的**。

这意味着在 ABAQUS 等软件中，必须启用**非对称矩阵存储和求解器**，否则会丢失信息导致收敛问题。

#### 5.5.2 顶点回归的一致切线刚度

顶点处的切线刚度比较特殊。由于最终应力固定在顶点（只依赖于材料参数 $k/\alpha$，不依赖于应变增量），应力对应变增量的"敏感性"为零：

$$
\mathbb{C}^{ep}_{\text{apex}} = \mathbf{0}
$$

这是一个**退化**的刚度矩阵，会导致数值困难。

实际处理方法：
- 使用一个很小的"人工刚度"代替零。
- 在顶点附近添加"帽盖"（Cap）或"圆角"修正。
- 采用弧长法等特殊求解技术。

### 5.6 常见实现陷阱

**1. $q^{\text{trial}} = 0$ 的处理**

当试探偏应力为零时（纯静水加载），$q^{\text{trial}} = 0$，计算 $\mathbf{s}^{\text{trial}}/q^{\text{trial}}$ 会出现除零错误。

**解决方案**：添加容差判断。如果 $q^{\text{trial}} < \text{TOL}$，直接判断是否屈服于顶点。

**2. 顶点判据的数值稳定性**

顶点判据 $q_{n+1} > 0$ 在数值上可能出现临界情况。

**解决方案**：使用一个小的正容差，如 $q_{n+1} > 10^{-10}$。

**3. 非关联流动的刚度矩阵**

忘记使用非对称求解器是最常见的错误之一。

**症状**：程序能跑，但收敛很慢或结果微妙地错误。

**4. 正负号约定**

DP 参数转换公式高度依赖正负号约定。不同来源可能有不同的约定。

**建议**：用简单的单元测试（单轴压缩、三轴压缩）验证实现的正确性。

### 5.7 本节小结

本节详细推导了 Drucker-Prager 塑性的回波映射算法：

1. **光滑面回归**适用于大多数情况，有闭式解 $\Delta\lambda = f^{\text{trial}}/(G + 9K\alpha\beta)$。

2. **顶点回归**发生在试探应力"冲过"侧面、指向顶点后方时，需要特殊处理。

3. **偏应力方向不变**的性质大大简化了 DP 的回波映射，使其可以得到闭式解而无需迭代。

4. **一致切线刚度**对于非关联流动是**非对称的**，必须使用相应的求解器。

5. **顶点奇异性**是 DP 实现中最大的数值挑战，需要仔细处理边界情况。

---

<!-- TAB_BREAK: 总结与推广 -->

## 第六部分：总结与推广——本构模型的哲学

### 6.1 回顾：J2 与 DP 的核心差异

经过前五部分的深入探讨，让我们用一张综合表格来总结 J2 (von Mises) 和 Drucker-Prager 这两个模型的核心差异：

| 维度               | J2 (von Mises)                          | Drucker-Prager                               |
| ------------------ | --------------------------------------- | -------------------------------------------- |
| **典型材料**       | 金属、部分聚合物                        | 岩石、土壤、混凝土                           |
| **屈服面几何**     | 无限长圆柱                              | 圆锥（顶点在拉伸侧）                         |
| **屈服函数**       | $f = \sqrt{3J_2} - \sigma_Y$            | $f = \sqrt{J_2} + \alpha I_1 - k$            |
| **压力敏感性**     | **无**（$\partial f/\partial I_1 = 0$） | **有**（$\partial f/\partial I_1 = \alpha$） |
| **塑性体积应变**   | **恒为零**                              | **非零**（剪胀/剪缩）                        |
| **流动法则**       | 关联                                    | 通常非关联                                   |
| **刚度矩阵对称性** | 对称                                    | 非关联时非对称                               |
| **回波映射**       | 径向回归（解耦）                        | 耦合回归 + 顶点处理                          |
| **数值复杂度**     | 低                                      | 中等                                         |

**物理本质的差异**：

- **J2** 描述的是**位错滑移**主导的塑性变形——金属晶体中的原子面相互错动，但原子间距（体积）保持不变。

- **DP** 描述的是**摩擦滑移**主导的塑性变形——颗粒或微裂纹面之间的摩擦阻力随正压力增大而增大，且滑移时颗粒需要"爬坡"导致体积变化。

### 6.2 DP 的局限性：为什么需要更复杂的模型？

Drucker-Prager 模型虽然比 von Mises 更适合岩土材料，但它仍然是一个高度简化的模型，存在几个重要的局限性：

#### 6.2.1 局限一：高压下的无限强度

DP 的圆锥屈服面向压缩方向无限张开。这意味着：**围压越高，材料的剪切强度越大，没有上限**。

但真实的岩土材料并非如此。当围压足够高时，材料会发生**压硬性屈服**或**压缩破坏**——颗粒被压碎、孔隙被压密，材料达到一个"极限"状态。

**例如**：深埋的土层在巨大的上覆压力下，不可能具有无限的强度。

#### 6.2.2 局限二：拉伸区的尖点

DP 圆锥在拉伸侧汇聚于一个**尖锐的顶点**。这在数值上造成麻烦（导数不连续），在物理上也过于简化——真实材料的拉伸破坏机制（如微裂纹扩展）与剪切破坏机制不同，不应该用同一个光滑函数来描述。

#### 6.2.3 局限三：偏平面上的正圆

DP 假设材料在偏平面上是各向同性的（屈服面截面为正圆），无法区分**三轴压缩**和**三轴拉伸**下的不同强度。

但实验表明，大多数岩土材料在三轴压缩下的强度**高于**三轴拉伸。Mohr-Coulomb 的六边形截面能捕捉这种差异，而 DP 的正圆不能。

#### 6.2.4 局限四：无法描述应变软化

基本的 DP 模型是理想塑性或硬化塑性，无法描述岩石在峰值强度后的**应变软化**行为——这对于分析岩体的渐进破坏和失稳非常重要。

### 6.3 进阶模型一：Cap Model（帽盖模型）

**Cap Model** 是针对 DP"高压无限强度"问题的经典解决方案。

#### 6.3.1 基本思想

在 DP 圆锥的压缩端（开口侧）加一个"帽盖"（Cap），封闭屈服面。帽盖通常是一个椭圆形的曲面，与圆锥的侧面光滑连接。

这样，屈服面变成了一个**封闭的"子弹头"形状**：
- 拉伸侧：圆锥顶点（或带圆角的顶点）。
- 侧面：圆锥面（摩擦屈服）。
- 压缩侧：椭圆帽盖（压缩屈服）。

#### 6.3.2 物理意义

- **圆锥侧面**：描述摩擦性剪切破坏，强度随围压增大。
- **椭圆帽盖**：描述压缩性屈服，当静水压力超过某个阈值时，材料发生体积压缩屈服。

帽盖的位置通常与**前期固结压力**或**压缩历史**有关。随着塑性体积压缩的累积，帽盖会向外移动（硬化），材料的抗压能力增强。

#### 6.3.3 典型应用

- 土的压缩固结行为
- 混凝土和岩石在高围压下的塑性变形
- 粉末压制成型
- 泡沫材料的压缩

**【图示建议】**

> **图6-1：Cap Model 的屈服面几何**
> 
> 图片展示子午线平面（$\sqrt{J_2}$ vs $I_1$）。
> 
> - 画出 DP 圆锥的两条侧面线（从顶点向左下延伸）。
> - 在圆锥开口端画一个**椭圆弧**（帽盖），与侧面光滑相切。
> - 帽盖内部（高压区）标注"帽盖屈服（压缩）"。
> - 圆锥侧面标注"剪切屈服（摩擦）"。
> - 顶点区域标注"拉伸截断"。
> - 用不同颜色区分三个区域。
> 
> 图的标题：**Cap Model：圆锥 + 帽盖的组合屈服面**

### 6.4 进阶模型二：Cam-Clay（剑桥模型）

**Cam-Clay 模型**（及其改进版 Modified Cam-Clay）是土力学领域最重要的本构模型之一，被誉为"临界状态土力学"的基石。

#### 6.4.1 核心概念：临界状态

Cam-Clay 引入了一个革命性的概念——**临界状态（Critical State）**：

> 当土体经历足够大的剪切变形后，无论其初始状态如何（松散或紧密），它都会趋向于一个**唯一的最终状态**，在这个状态下：
> - 体积不再变化（$d\varepsilon_v^p = 0$）
> - 剪切可以无限持续（完全塑性流动）
> - 应力比 $q/p$ 达到一个常数 $M$

临界状态线（CSL）在 $e$-$\ln p$ 空间（孔隙比 vs 对数平均应力）和 $q$-$p$ 空间中都是直线。

#### 6.4.2 屈服面形状

Modified Cam-Clay 的屈服面在 $q$-$p$ 平面上是一个**椭圆**：

$$
f = \frac{q^2}{M^2} + p(p - p_c) = 0
$$

其中：
- $M$：临界状态应力比（与摩擦角有关）
- $p_c$：**前期固结压力**，是硬化变量，随塑性体积应变演化

椭圆的一端通过原点（拉伸截断），另一端在 $p = p_c$ 处与 $p$ 轴相交。临界状态线 $q = Mp$ 恰好通过椭圆的"顶点"。

#### 6.4.3 独特的预测能力

Cam-Clay 模型能够统一描述多种土的行为：

| 土的状态          | 在 CSL 哪一侧 | 剪切时的体积变化 | 峰值强度         |
| ----------------- | ------------- | ---------------- | ---------------- |
| **正常固结/松散** | CSL 的"湿侧"  | 剪缩（体积减小） | 无峰值，单调硬化 |
| **超固结/紧密**   | CSL 的"干侧"  | 先剪缩后剪胀     | 有峰值，后软化   |

这种"状态依赖"的行为是 DP 模型无法描述的。

#### 6.4.4 与 DP 的对比

| 特征       | Drucker-Prager      | Cam-Clay           |
| ---------- | ------------------- | ------------------ |
| 屈服面形状 | 开口圆锥            | 封闭椭圆           |
| 硬化变量   | 通常无或简单        | 前期固结压力 $p_c$ |
| 剪胀描述   | 固定的剪胀角 $\psi$ | 状态依赖，自动演化 |
| 临界状态   | 不涉及              | 核心概念           |
| 适用范围   | 一般岩土            | 主要是黏土         |

### 6.5 进阶模型三：Hoek-Brown（霍克-布朗准则）

**Hoek-Brown 准则**是岩石力学领域最广泛使用的强度准则之一，专门针对**岩体（Rock Mass）**——不是完整的岩石试样，而是包含节理、裂隙等不连续面的真实岩体。

#### 6.5.1 背景：从岩石到岩体

实验室测试的是小尺寸的"完整岩石"试样，但工程中面对的是大尺度的"岩体"。岩体中存在大量的节理、裂隙、断层等结构面，使其强度远低于完整岩石。

Hoek-Brown 准则提供了一个从实验室岩石强度**外推到**现场岩体强度的框架。

#### 6.5.2 数学形式

**原始 Hoek-Brown 准则**（1980）：

$$
\sigma_1 = \sigma_3 + \sigma_{ci} \left( m_i \frac{\sigma_3}{\sigma_{ci}} + 1 \right)^{0.5}
$$

**广义 Hoek-Brown 准则**（2002，考虑岩体质量）：

$$
\sigma_1 = \sigma_3 + \sigma_{ci} \left( m_b \frac{\sigma_3}{\sigma_{ci}} + s \right)^a
$$

其中：
- $\sigma_1, \sigma_3$：最大和最小主应力
- $\sigma_{ci}$：完整岩石的单轴抗压强度
- $m_i$：完整岩石的材料常数（与岩石类型有关，通常 4~35）
- $m_b, s, a$：岩体参数，取决于岩体质量评分（如 GSI）

**岩体参数的计算**：

$$
m_b = m_i \exp\left(\frac{GSI - 100}{28 - 14D}\right)
$$

$$
s = \exp\left(\frac{GSI - 100}{9 - 3D}\right)
$$

$$
a = \frac{1}{2} + \frac{1}{6}\left(e^{-GSI/15} - e^{-20/3}\right)
$$

其中：
- $GSI$：地质强度指标（Geological Strength Index），范围 0~100
- $D$：扰动因子（Disturbance Factor），范围 0~1，反映爆破等施工扰动

#### 6.5.3 屈服面的几何特征

Hoek-Brown 屈服面在主应力空间中是一个**非线性的曲面**：

- **子午线**：不是直线（如 DP），而是**向外弯曲的曲线**。在低围压下曲率大（接近抛物线），高围压下逐渐趋于线性。
- **偏平面截面**：类似于 DP 的圆形，但半径随 $I_1$ 非线性变化。
- **拉伸截断**：有明确的**抗拉强度**（当 $\sigma_3 < 0$ 时）。

**与 DP/Mohr-Coulomb 的对比**：

| 特征       | Mohr-Coulomb / DP               | Hoek-Brown                     |
| ---------- | ------------------------------- | ------------------------------ |
| 子午线形状 | 直线                            | **曲线**（低压弯曲，高压趋直） |
| 参数       | $c$, $\phi$（或 $\alpha$, $k$） | $\sigma_{ci}$, $m_b$, $s$, $a$ |
| 拉伸强度   | 由 $c$, $\phi$ 隐含确定         | 显式考虑                       |
| 围压影响   | 强度随围压**线性**增加          | 强度随围压**非线性**增加       |
| 适用材料   | 土、一般岩石                    | **节理岩体**                   |

#### 6.5.4 非线性的物理意义

为什么 Hoek-Brown 是非线性的，而 Mohr-Coulomb 是线性的？

**物理解释**：

- **Mohr-Coulomb** 假设破坏面上的摩擦系数（$\tan\phi$）是常数，与正应力无关。这对于土和某些岩石是合理的近似。

- **Hoek-Brown** 认识到，对于节理岩体，随着围压增大：
  - 节理面被压紧，咬合程度增加
  - 微裂纹被压闭
  - 破坏模式从"沿节理滑移"转变为"穿越完整岩石"

  这些效应导致**等效摩擦角随围压增大而减小**，强度包络线呈现向外弯曲的形态。

#### 6.5.5 Hoek-Brown 与等效 Mohr-Coulomb 参数

由于许多有限元软件不直接支持 Hoek-Brown，工程中常需要将其转换为**等效的 Mohr-Coulomb 参数**。

Hoek 等人（2002）给出了在指定围压范围 $[\sigma_{3,\min}, \sigma_{3,\max}]$ 内的最佳拟合公式：

$$
\phi' = \sin^{-1}\left[\frac{6am_b(s + m_b\sigma'_{3n})^{a-1}}{2(1+a)(2+a) + 6am_b(s + m_b\sigma'_{3n})^{a-1}}\right]
$$

$$
c' = \frac{\sigma_{ci}[(1+2a)s + (1-a)m_b\sigma'_{3n}](s + m_b\sigma'_{3n})^{a-1}}{(1+a)(2+a)\sqrt{1 + [6am_b(s+m_b\sigma'_{3n})^{a-1}]/[(1+a)(2+a)]}}
$$

其中 $\sigma'_{3n} = \sigma'_{3,\max}/\sigma_{ci}$。

**重要提醒**：等效参数是**围压相关的**！在不同的围压范围内，等效的 $c'$ 和 $\phi'$ 会不同。直接使用单一的等效参数会在某些应力区间产生显著误差。

#### 6.5.6 数值实现要点

如果要在 UMAT 中实现 Hoek-Brown：

1. **屈服函数**需要重新定义（非线性形式）
2. **流动法则**通常采用非关联（剪胀角小于摩擦角）
3. **回波映射**变得更复杂，通常需要**牛顿迭代**求解塑性乘子，因为没有闭式解
4. **一致切线刚度**需要仔细推导，涉及非线性函数的导数

**【图示建议】**

> **图6-2：Hoek-Brown 与 Mohr-Coulomb 屈服面对比**
> 
> 图片展示 $\sigma_1$ vs $\sigma_3$ 空间（主应力空间的一个切面）。
> 
> - 画出 Mohr-Coulomb 的屈服线：一条直线，从 $\sigma_3 = -\sigma_t$（抗拉强度）开始，斜率为 $(1+\sin\phi)/(1-\sin\phi)$。
> - 画出 Hoek-Brown 的屈服线：一条**向上弯曲的曲线**，在低围压区明显弯曲，高围压区逐渐趋于直线。
> - 两条线在某个围压范围内可以近似重合（等效 MC 参数的拟合区间）。
> - 标注 Hoek-Brown 曲线的特点："低围压：曲率大"和"高围压：趋于线性"。
> - 标注两者在拉伸区的差异。
> 
> 图的标题：**Hoek-Brown vs Mohr-Coulomb：非线性 vs 线性强度包络**

### 6.6 更多高级模型概览

除了上述模型，还有许多针对特定材料或行为的高级本构模型：

#### 6.6.1 描述各向异性的模型

- **Hill 屈服准则**：金属板材的各向异性塑性
- **横观各向同性 DP**：层状岩体、页岩
- **Fabric Tensor 模型**：考虑颗粒排列方向的砂土

#### 6.6.2 描述损伤与软化的模型

- **Concrete Damaged Plasticity (CDP)**：ABAQUS 中的混凝土模型，耦合塑性与损伤
- **Gurson 模型**：考虑孔洞演化的金属延性损伤
- **Cohesive Zone 模型**：裂纹扩展的界面模型

#### 6.6.3 描述时间效应的模型

- **黏塑性模型（Perzyna 型）**：应变率相关的塑性
- **蠕变模型**：长期载荷下的时间依赖变形

#### 6.6.4 高级土模型

- **Nor-Sand**：砂土的状态相关模型
- **MIT-E3 / MIT-S1**：高级黏土模型
- **Hypoplasticity**：超塑性，无需定义屈服面的连续变形模型

### 6.7 给初学者的建议：学习路径

如果你是刚开始学习计算塑性力学的研究生或工程师，建议按以下顺序循序渐进：

**第一阶段：打好基础**

1. **彻底理解 J2 (von Mises) 塑性**
   - 手推径向回归算法
   - 自己写一个单点驱动程序验证
   - 推导并实现一致切线刚度

2. **理解 J2 硬化塑性**
   - 等向硬化与随动硬化的区别
   - 硬化曲线的数值处理

**第二阶段：进入岩土力学**

3. **掌握 Drucker-Prager 塑性**（本文的重点）
   - 理解压力敏感性和剪胀性
   - 实现光滑面回归和顶点处理
   - 体会非关联流动的影响

4. **了解 Mohr-Coulomb 的数值处理**
   - 角点和边的特殊处理
   - 与 DP 的等效转换

**第三阶段：专业方向**

5. **根据研究方向选择深入**
   - 土力学 → Cam-Clay, Nor-Sand
   - 岩石力学 → Hoek-Brown, 损伤模型
   - 混凝土 → CDP, 断裂力学
   - 金属成形 → Hill, Gurson

**实践建议**：

- **先理论，后编程**：确保公式理解正确再动手写代码
- **先单点，后单元**：先验证本构子程序的正确性，再嵌入有限元
- **先简单，后复杂**：从理想塑性开始，逐步添加硬化、非关联流动等
- **多验证**：与解析解、实验数据、商业软件结果对比

### 6.8 结语：本构模型的哲学

本构模型是**现实世界的数学抽象**。没有任何一个模型能够完美描述真实材料的所有行为——我们能做的，只是在**精度**和**复杂度**之间寻找平衡。

**J2 (von Mises)** 是这种平衡的一个极端：它简单到只用一个参数（$\sigma_Y$）就能描述金属的塑性行为，而且在大多数工程应用中足够准确。这就是它能流行一个世纪的原因。

**Drucker-Prager** 在 J2 的基础上迈出了关键一步：引入压力敏感性。这一步的代价是增加了一个参数（$\alpha$ 或 $\phi$）和计算复杂度，但换来了对岩土材料的适用性。

**Hoek-Brown** 则针对岩石工程的特殊需求，引入了非线性强度包络和岩体质量评价体系，成为隧道、边坡、地下工程的标准工具。

**Cam-Clay** 走得更远，引入了状态变量和临界状态概念，能够统一描述土的多种复杂行为。但代价是更多的参数和更复杂的标定过程。

选择哪个模型，取决于：

1. **你要分析什么材料？** —— 金属、土、岩石、混凝土？
2. **你关心什么行为？** —— 初始屈服、大变形、循环加载、时间效应？
3. **你有什么数据？** —— 能标定多少参数？
4. **你能接受多少计算成本？** —— 简单项目还是深入研究？

没有"最好"的模型，只有"最合适"的模型。

希望这篇文章能帮助你建立对塑性本构模型的系统认识，在面对有限元软件的材料库时不再迷茫，在需要编写 UMAT 时有据可循。

塑性力学的大门已经打开，前方还有无限的探索空间。

---

**【全文完】**